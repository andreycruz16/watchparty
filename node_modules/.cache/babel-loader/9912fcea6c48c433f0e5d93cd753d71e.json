{"ast":null,"code":"import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/regenerator/index.js\";import React from'react';import{Modal,Button,Icon,Image}from'semantic-ui-react';import firebase from'firebase/compat/app';import'firebase/compat/auth';import{serverPath}from'../../utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ProfileModal=/*#__PURE__*/function(_React$Component){_inherits(ProfileModal,_React$Component);var _super=_createSuper(ProfileModal);function ProfileModal(){var _this;_classCallCheck(this,ProfileModal);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={resetDisabled:false,verifyDisabled:false,deleteConfirmOpen:false};_this.onSignOut=function(){firebase.auth().signOut();window.location.reload();};_this.resetPassword=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!_this.props.user.email){_context.next=5;break;}_context.next=4;return firebase.auth().sendPasswordResetEmail(_this.props.user.email);case 4:_this.setState({resetDisabled:true});case 5:_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.warn(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));_this.verifyEmail=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!_this.props.user){_context2.next=5;break;}_context2.next=4;return _this.props.user.sendEmailVerification();case 4:_this.setState({verifyDisabled:true});case 5:_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.warn(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));_this.deleteAccountConfirm=function(){_this.setState({deleteConfirmOpen:true});};_this.deleteAccount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var token;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _this.props.user.getIdToken();case 2:token=_context3.sent;_context3.next=5;return window.fetch(serverPath+'/deleteAccount',{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({uid:_this.props.user.uid,token:token})});case 5:window.location.reload();case 6:case\"end\":return _context3.stop();}}},_callee3);}));return _this;}_createClass(ProfileModal,[{key:\"render\",value:function render(){var _this2=this;var _this$props=this.props,close=_this$props.close,userImage=_this$props.userImage;return/*#__PURE__*/_jsxs(Modal,{open:true,onClose:close,size:\"tiny\",children:[/*#__PURE__*/_jsxs(Modal,{open:this.state.deleteConfirmOpen,onClose:function onClose(){_this2.setState({deleteConfirmOpen:false});},size:\"tiny\",children:[/*#__PURE__*/_jsx(Modal.Header,{children:\"Delete Your Account\"}),/*#__PURE__*/_jsx(Modal.Content,{children:/*#__PURE__*/_jsx(\"p\",{children:\"Are you sure you want to delete your account? This can't be undone.\"})}),/*#__PURE__*/_jsxs(Modal.Actions,{children:[/*#__PURE__*/_jsx(Button,{positive:true,onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _this2.deleteAccount();case 2:case\"end\":return _context4.stop();}}},_callee4);})),children:\"Yes\"}),/*#__PURE__*/_jsx(Button,{negative:true,onClick:function onClick(){_this2.setState({deleteConfirmOpen:false});},children:\"No\"})]})]}),/*#__PURE__*/_jsxs(Modal.Header,{children:[/*#__PURE__*/_jsx(Image,{avatar:true,src:userImage}),this.props.user.email,this.props.user.emailVerified&&/*#__PURE__*/_jsx(Icon,{style:{marginLeft:'8px'},title:\"Thie email is verified\",name:\"check circle\"})]}),/*#__PURE__*/_jsx(Modal.Content,{children:/*#__PURE__*/_jsxs(\"div\",{style:{width:'300px',display:'flex',alignItems:'center',flexDirection:'column',gap:'10px'},children:[/*#__PURE__*/_jsxs(Button,{icon:true,labelPosition:\"left\",fluid:true,href:\"https://gravatar.com\",target:\"_blank\",color:\"blue\",children:[/*#__PURE__*/_jsx(Icon,{name:\"image\"}),\"Edit Gravatar\"]}),/*#__PURE__*/_jsxs(Button,{disabled:this.props.user.emailVerified||this.state.verifyDisabled,icon:true,labelPosition:\"left\",fluid:true,color:\"purple\",onClick:this.verifyEmail,children:[/*#__PURE__*/_jsx(Icon,{name:\"check circle\"}),\"Verify Email\"]}),/*#__PURE__*/_jsxs(Button,{disabled:this.state.resetDisabled,icon:true,labelPosition:\"left\",fluid:true,color:\"green\",onClick:this.resetPassword,children:[/*#__PURE__*/_jsx(Icon,{name:\"key\"}),\"Reset Password\"]}),/*#__PURE__*/_jsxs(Button,{icon:true,labelPosition:\"left\",fluid:true,color:\"red\",onClick:this.deleteAccountConfirm,children:[/*#__PURE__*/_jsx(Icon,{name:\"trash\"}),\"Delete Account\"]}),/*#__PURE__*/_jsxs(Button,{icon:true,labelPosition:\"left\",onClick:this.onSignOut,fluid:true,children:[/*#__PURE__*/_jsx(Icon,{name:\"sign out\"}),\"Sign out\"]})]})})]});}}]);return ProfileModal;}(React.Component);","map":{"version":3,"sources":["/home/runner/work/watchparty/watchparty/src/components/Modal/ProfileModal.tsx"],"names":["React","Modal","Button","Icon","Image","firebase","serverPath","ProfileModal","state","resetDisabled","verifyDisabled","deleteConfirmOpen","onSignOut","auth","signOut","window","location","reload","resetPassword","props","user","email","sendPasswordResetEmail","setState","console","warn","verifyEmail","sendEmailVerification","deleteAccountConfirm","deleteAccount","getIdToken","token","fetch","method","headers","body","JSON","stringify","uid","close","userImage","emailVerified","marginLeft","width","display","alignItems","flexDirection","gap","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Modal, Button, Icon, Image } from 'semantic-ui-react';\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/auth';\nimport { serverPath } from '../../utils';\n\nexport class ProfileModal extends React.Component<{\n  close: Function;\n  user: firebase.User;\n  userImage: string | null;\n}> {\n  public state = {\n    resetDisabled: false,\n    verifyDisabled: false,\n    deleteConfirmOpen: false,\n  };\n\n  onSignOut = () => {\n    firebase.auth().signOut();\n    window.location.reload();\n  };\n\n  resetPassword = async () => {\n    try {\n      if (this.props.user.email) {\n        await firebase.auth().sendPasswordResetEmail(this.props.user.email);\n        this.setState({ resetDisabled: true });\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n  };\n\n  verifyEmail = async () => {\n    try {\n      if (this.props.user) {\n        await this.props.user.sendEmailVerification();\n        this.setState({ verifyDisabled: true });\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n  };\n\n  deleteAccountConfirm = () => {\n    this.setState({ deleteConfirmOpen: true });\n  };\n\n  deleteAccount = async () => {\n    const token = await this.props.user.getIdToken();\n    await window.fetch(serverPath + '/deleteAccount', {\n      method: 'DELETE',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ uid: this.props.user.uid, token }),\n    });\n    window.location.reload();\n  };\n\n  render() {\n    const { close, userImage } = this.props;\n    return (\n      <Modal open={true} onClose={close as any} size=\"tiny\">\n        <Modal\n          open={this.state.deleteConfirmOpen}\n          onClose={() => {\n            this.setState({ deleteConfirmOpen: false });\n          }}\n          size=\"tiny\"\n        >\n          <Modal.Header>Delete Your Account</Modal.Header>\n          <Modal.Content>\n            <p>\n              Are you sure you want to delete your account? This can't be\n              undone.\n            </p>\n          </Modal.Content>\n          <Modal.Actions>\n            <Button\n              positive\n              onClick={async () => {\n                await this.deleteAccount();\n              }}\n            >\n              Yes\n            </Button>\n            <Button\n              negative\n              onClick={() => {\n                this.setState({ deleteConfirmOpen: false });\n              }}\n            >\n              No\n            </Button>\n          </Modal.Actions>\n        </Modal>\n        <Modal.Header>\n          <Image avatar src={userImage} />\n          {this.props.user.email}\n          {this.props.user.emailVerified && (\n            <Icon\n              style={{ marginLeft: '8px' }}\n              title=\"Thie email is verified\"\n              name=\"check circle\"\n            ></Icon>\n          )}\n        </Modal.Header>\n        <Modal.Content>\n          <div\n            style={{\n              width: '300px',\n              display: 'flex',\n              alignItems: 'center',\n              flexDirection: 'column',\n              gap: '10px',\n            }}\n          >\n            <Button\n              icon\n              labelPosition=\"left\"\n              fluid\n              href=\"https://gravatar.com\"\n              target=\"_blank\"\n              color=\"blue\"\n            >\n              <Icon name=\"image\" />\n              Edit Gravatar\n            </Button>\n            <Button\n              disabled={\n                this.props.user.emailVerified || this.state.verifyDisabled\n              }\n              icon\n              labelPosition=\"left\"\n              fluid\n              color=\"purple\"\n              onClick={this.verifyEmail}\n            >\n              <Icon name=\"check circle\" />\n              Verify Email\n            </Button>\n            <Button\n              disabled={this.state.resetDisabled}\n              icon\n              labelPosition=\"left\"\n              fluid\n              color=\"green\"\n              onClick={this.resetPassword}\n            >\n              <Icon name=\"key\" />\n              Reset Password\n            </Button>\n            <Button\n              icon\n              labelPosition=\"left\"\n              fluid\n              color=\"red\"\n              onClick={this.deleteAccountConfirm}\n            >\n              <Icon name=\"trash\" />\n              Delete Account\n            </Button>\n            <Button icon labelPosition=\"left\" onClick={this.onSignOut} fluid>\n              <Icon name=\"sign out\" />\n              Sign out\n            </Button>\n          </div>\n        </Modal.Content>\n      </Modal>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}