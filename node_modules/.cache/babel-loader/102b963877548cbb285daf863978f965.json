{"ast":null,"code":"import _toConsumableArray from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import _regeneratorRuntime from\"/home/runner/work/watchparty/watchparty/node_modules/@babel/runtime/regenerator/index.js\";import'./App.css';import querystring from'querystring';import axios from'axios';import React from'react';import{Button,Dimmer,Dropdown,Grid,Icon,Input,Loader,Message,Popup,Progress,Menu,Modal,Label}from'semantic-ui-react';import io from'socket.io-client';import{default as toWebVTT}from'srt-webvtt';import{formatSpeed,getMediaType,iceServers,isMobile,serverPath,testAutoplay,openFileSelector,getAndSaveClientId,calculateMedian,getUserImage,getColorForString}from'../../utils';import{generateName}from'../../utils/generateName';import{Chat}from'../Chat';import{TopBar}from'../TopBar';import{VBrowser}from'../VBrowser';import{VideoChat}from'../VideoChat';import{getCurrentSettings}from'../Settings';import{MultiStreamModal}from'../Modal/MultiStreamModal';import{ComboBox}from'../ComboBox/ComboBox';import{SearchComponent}from'../SearchComponent/SearchComponent';import{Controls}from'../Controls/Controls';import{VBrowserModal}from'../Modal/VBrowserModal';import{SettingsTab}from'../Settings/SettingsTab';import{ErrorModal}from'../Modal/ErrorModal';import{PasswordModal}from'../Modal/PasswordModal';import{SubscribeButton}from'../SubscribeButton/SubscribeButton';import{ScreenShareModal}from'../Modal/ScreenShareModal';import{FileShareModal}from'../Modal/FileShareModal';import{SubtitleModal}from'../Modal/SubtitleModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";window.watchparty={ourStream:undefined,videoRefs:{},videoPCs:{}};var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(){var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={state:'starting',currentMedia:'',currentMediaPaused:false,currentSubtitle:'',participants:[],rosterUpdateTS:Number(new Date()),chat:[],playlist:[],tsMap:{},nameMap:{},pictureMap:{},myName:'',myPicture:'',loading:true,scrollTimestamp:0,unreadCount:0,fullScreen:false,controlsTimestamp:0,watchOptions:[],isScreenSharing:false,isScreenSharingFile:false,isVBrowser:false,isYouTubeReady:false,isAutoPlayable:true,downloaded:0,total:0,speed:0,connections:0,multiStreamSelection:undefined,error:'',isErrorAuth:false,settings:{},vBrowserResolution:'1280x720@30',isVBrowserLarge:false,nonPlayableMedia:false,currentTab:querystring.parse(window.location.search.substring(1)).tab||'chat',isSubscribeModalOpen:false,isVBrowserModalOpen:false,isScreenShareModalOpen:false,isFileShareModalOpen:false,isSubtitleModalOpen:false,roomLock:'',controller:'',roomId:'',savedPasswords:{},errorMessage:'',successMessage:'',isChatDisabled:false,showRightBar:true,owner:undefined,vanity:undefined,password:undefined,roomLink:'',roomTitle:'',roomDescription:'',roomTitleColor:'',mediaPath:undefined};_this.socket=null;_this.watchPartyYTPlayer=null;_this.ytDebounce=true;_this.screenShareStream=void 0;_this.screenHostPC={};_this.screenSharePC=void 0;_this.progressUpdater=void 0;_this.heartbeat=undefined;_this.chatRef=/*#__PURE__*/React.createRef();_this.getRoomLink=function(vanity){if(vanity){return\"\".concat(window.location.origin,\"/r/\").concat(vanity);}return\"\".concat(window.location.origin).concat(_this.state.roomId.replace('/','#'));};_this.handleRoomState=function(data){_this.setOwner(data.owner);_this.setVanity(data.vanity);_this.setPassword(data.password);_this.setRoomLink(_this.getRoomLink(data.vanity));_this.setIsChatDisabled(data.isChatDisabled);_this.setRoomTitle(data.roomTitle);_this.setRoomDescription(data.roomDescription);_this.setRoomTitleColor(data.roomTitleColor);_this.setMediaPath(data.mediaPath);window.history.replaceState('','',_this.getRoomLink(data.vanity));};_this.loadSettings=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var settings;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// Load settings from localstorage\nsettings=getCurrentSettings();_this.setState({settings:settings});case 2:case\"end\":return _context.stop();}}},_callee);}));_this.loadSignInData=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var user,_user$displayName,firstName,userImage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:user=_this.props.user;if(!(user&&_this.socket)){_context2.next=9;break;}// NOTE: firebase auth doesn't provide the actual first name data that individual providers (G/FB) do\n// It's accessible at the time the user logs in but not afterward\n// If we want accurate surname/given name we'll need to save that somewhere\nfirstName=(_user$displayName=user.displayName)===null||_user$displayName===void 0?void 0:_user$displayName.split(' ')[0];if(firstName){_this.updateName(null,{value:firstName});}_context2.next=6;return getUserImage(user);case 6:userImage=_context2.sent;if(userImage){_this.updatePicture(userImage);}_this.updateUid(user);case 9:case\"end\":return _context2.stop();}}},_callee2);}));_this.loadYouTube=function(){// This code loads the IFrame Player API code asynchronously.\nvar tag=document.createElement('script');tag.src='https://www.youtube.com/iframe_api';document.body.append(tag);window.onYouTubeIframeAPIReady=function(){// Note: this fails silently if the element is not available\nvar ytPlayer=new window.YT.Player('leftYt',{events:{onReady:function onReady(){_this.watchPartyYTPlayer=ytPlayer;_this.setState({isYouTubeReady:true,loading:false});// We might have failed to play YT originally, ask for the current video again\nif(_this.isYouTube()){_this.socket.emit('CMD:askHost');}},onStateChange:function onStateChange(e){var _window$YT,_window$YT$PlayerStat,_window$YT2,_window$YT2$PlayerSta,_window$YT3,_window$YT3$PlayerSta,_window$YT4,_window$YT4$PlayerSta;if(getMediaType(_this.state.currentMedia)==='youtube'&&e.data===((_window$YT=window.YT)===null||_window$YT===void 0?void 0:(_window$YT$PlayerStat=_window$YT.PlayerState)===null||_window$YT$PlayerStat===void 0?void 0:_window$YT$PlayerStat.CUED)){_this.setState({loading:false});}if(getMediaType(_this.state.currentMedia)==='youtube'&&e.data===((_window$YT2=window.YT)===null||_window$YT2===void 0?void 0:(_window$YT2$PlayerSta=_window$YT2.PlayerState)===null||_window$YT2$PlayerSta===void 0?void 0:_window$YT2$PlayerSta.ENDED)){_this.onVideoEnded();}// console.log(this.ytDebounce, e.data, this.watchPartyYTPlayer?.getVideoUrl());\nif(_this.ytDebounce&&(e.data===((_window$YT3=window.YT)===null||_window$YT3===void 0?void 0:(_window$YT3$PlayerSta=_window$YT3.PlayerState)===null||_window$YT3$PlayerSta===void 0?void 0:_window$YT3$PlayerSta.PLAYING)&&_this.state.currentMediaPaused||e.data===((_window$YT4=window.YT)===null||_window$YT4===void 0?void 0:(_window$YT4$PlayerSta=_window$YT4.PlayerState)===null||_window$YT4$PlayerSta===void 0?void 0:_window$YT4$PlayerSta.PAUSED)&&!_this.state.currentMediaPaused)){var _window$YT5,_window$YT5$PlayerSta;_this.ytDebounce=false;if(e.data===((_window$YT5=window.YT)===null||_window$YT5===void 0?void 0:(_window$YT5$PlayerSta=_window$YT5.PlayerState)===null||_window$YT5$PlayerSta===void 0?void 0:_window$YT5$PlayerSta.PLAYING)){_this.socket.emit('CMD:play');_this.doPlay();}else{_this.socket.emit('CMD:pause');_this.doPause();}window.setTimeout(function(){return _this.ytDebounce=true;},500);}}}});};};_this.setOwner=function(owner){_this.setState({owner:owner});};_this.setVanity=function(vanity){_this.setState({vanity:vanity});};_this.setPassword=function(password){_this.setState({password:password});};_this.setRoomLink=function(roomLink){_this.setState({roomLink:roomLink});};_this.setRoomTitle=function(roomTitle){_this.setState({roomTitle:roomTitle});};_this.setRoomDescription=function(roomDescription){_this.setState({roomDescription:roomDescription});};_this.setRoomTitleColor=function(roomTitleColor){_this.setState({roomTitleColor:roomTitleColor});};_this.setMediaPath=function(mediaPath){_this.setState({mediaPath:mediaPath});};_this.init=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var roomId,query,response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// Load room ID from url\nroomId='/default';query=window.location.hash.substring(1);if(query){roomId='/'+query;}// if a vanity name, resolve the url to a room id\nif(!_this.props.vanity){_context3.next=20;break;}_context3.prev=4;_context3.next=7;return axios.get(serverPath+'/resolveRoom/'+_this.props.vanity);case 7:response=_context3.sent;if(!response.data.roomId){_context3.next=12;break;}roomId=response.data.roomId;_context3.next=13;break;case 12:throw new Error('failed to resolve room name');case 13:_context3.next=20;break;case 15:_context3.prev=15;_context3.t0=_context3[\"catch\"](4);console.error(_context3.t0);_this.setState({error:\"There's no room with this name.\"});return _context3.abrupt(\"return\");case 20:_this.setState({roomId:roomId},function(){_this.join(roomId);});case 21:case\"end\":return _context3.stop();}}},_callee3,null,[[4,15]]);}));_this.join=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(roomId){var password,savedPasswordsString,savedPasswords,shard,_$exec$,_$exec,socket;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:password='';try{savedPasswordsString=window.localStorage.getItem('watchparty-passwords');savedPasswords=JSON.parse(savedPasswordsString||'{}');_this.setState({savedPasswords:savedPasswords});password=savedPasswords[roomId]||'';}catch(e){console.warn('[ALERT] Could not parse saved passwords');}shard='';if(/^\\d/.test(roomId.slice(1))){// Rooms assigned to shards start with a number\nshard=(_$exec$=(_$exec=/^\\d+/.exec(roomId.slice(1)))===null||_$exec===void 0?void 0:_$exec[0])!==null&&_$exec$!==void 0?_$exec$:'';}socket=io(serverPath+roomId,{transports:['websocket'],query:{clientId:getAndSaveClientId(),password:password,shard:shard}});_this.socket=socket;socket.on('connect',/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var userName;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this.setState({state:'connected'});// Load username from localstorage\nuserName=window.localStorage.getItem('watchparty-username');_this.updateName(null,{value:userName||generateName()});_this.loadSignInData();case 4:case\"end\":return _context4.stop();}}},_callee4);})));socket.on('error',function(err){console.error(err);if(err==='Invalid namespace'){_this.setState({error:\"There's no room with this name.\"});}else if(err==='not authorized'){_this.setState({isErrorAuth:true});}else if(err==='room full'){_this.setState({error:'This room is full.'});}else{_this.setState({error:'An error occurred.'});}});socket.on('errorMessage',function(err){_this.setState({errorMessage:err});setTimeout(function(){_this.setState({errorMessage:''});},3000);});socket.on('successMessage',function(success){_this.setState({successMessage:success});setTimeout(function(){_this.setState({successMessage:''});},3000);});socket.on('kicked',function(){window.location.assign('/');});socket.on('REC:play',function(){_this.doPlay();});socket.on('REC:pause',function(){_this.doPause();});socket.on('REC:seek',function(data){_this.doSeek(data);});socket.on('REC:subtitle',function(data){_this.setState({currentSubtitle:data},function(){_this.loadSubtitles();});});socket.on('REC:changeController',function(data){_this.setState({controller:data});});socket.on('REC:host',/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(data){var currentMedia;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:currentMedia=data.video||'';if(_this.isScreenShare()&&!currentMedia.startsWith('screenshare://')){_this.stopScreenShare();}if(_this.isFileShare()&&!currentMedia.startsWith('fileshare://')){_this.stopScreenShare();}if(!(_this.isScreenShare()&&currentMedia.startsWith('screenshare://'))){_context6.next=5;break;}return _context6.abrupt(\"return\");case 5:if(!(_this.isFileShare()&&currentMedia.startsWith('fileshare://'))){_context6.next=7;break;}return _context6.abrupt(\"return\");case 7:if(_this.isVBrowser()&&!currentMedia.startsWith('vbrowser://')){_this.stopVBrowser();}_this.setState({currentMedia:currentMedia,currentMediaPaused:data.paused,currentSubtitle:data.subtitle,loading:Boolean(data.video),nonPlayableMedia:false,isVBrowserLarge:data.isVBrowserLarge,vBrowserResolution:data.isVBrowserLarge?'1920x1080@30':'1280x720@30',controller:data.controller},function(){var _this$watchPartyYTPla;if(_this.state.isScreenSharingFile||_this.isVBrowser()&&_this.getVBrowserHost()){console.log('skipping REC:host video since fileshare is using leftVideo or this is a vbrowser');_this.setLoadingFalse();return;}// Stop all players\nvar leftVideo=document.getElementById('leftVideo');leftVideo===null||leftVideo===void 0?void 0:leftVideo.pause();(_this$watchPartyYTPla=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla===void 0?void 0:_this$watchPartyYTPla.stopVideo();if(_this.isYouTube()&&!_this.watchPartyYTPlayer){console.log('YT player not ready, onReady callback will retry when it is');}else if(_this.isVBrowser()){console.log('not playing video as this is a vbrowser:// placeholder');}else{// Start this video\n_this.doSrc(data.video,data.videoTS);if(!data.paused){_this.doPlay();}if(data.subtitle){_this.loadSubtitles();}// else if (this.isHttp() && !this.isYouTube()) {\n//   const src = data.video;\n//   const subtitlePath = src.slice(0, src.lastIndexOf('/') + 1);\n//   // Expect subtitle name to be file name + .srt\n//   const subtitleSrc = subtitlePath + 'subtitles/' + this.getFileName(src) + '.srt';\n//   this.setState({ currentSubtitle: subtitleSrc }, () => {\n//     this.loadSubtitles();\n//   });\n// }\n// One time, when we're ready to play\nleftVideo===null||leftVideo===void 0?void 0:leftVideo.addEventListener('canplay',function(){_this.setLoadingFalse();_this.jumpToLeader();},{once:true});// Progress updater\nwindow.clearInterval(_this.progressUpdater);_this.setState({downloaded:0,total:0,speed:0});if(currentMedia.includes('/stream?torrent=magnet')){_this.progressUpdater=window.setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var response,data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return window.fetch(currentMedia.replace('/stream','/progress'));case 2:response=_context5.sent;_context5.next=5;return response.json();case 5:data=_context5.sent;_this.setState({downloaded:data.downloaded,total:data.total,speed:data.speed,connections:data.connections});case 7:case\"end\":return _context5.stop();}}},_callee5);})),1000);}}});case 9:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x2){return _ref6.apply(this,arguments);};}());socket.on('REC:chat',function(data){if(!getCurrentSettings().disableChatSound&&(document.visibilityState&&document.visibilityState!=='visible'||_this.state.currentTab!=='chat')){new Audio('/clearly.mp3').play();}_this.state.chat.push(data);_this.setState({chat:_this.state.chat,scrollTimestamp:Number(new Date()),unreadCount:_this.state.currentTab==='chat'?_this.state.unreadCount:_this.state.unreadCount+1});});socket.on('REC:addReaction',function(data){var chat=_this.state.chat;var msgIndex=chat.findIndex(function(m){return m.id===data.msgId&&m.timestamp===data.msgTimestamp;});if(msgIndex===-1){return;}var msg=chat[msgIndex];msg.reactions=msg.reactions||{};msg.reactions[data.value]=msg.reactions[data.value]||[];msg.reactions[data.value].push(data.user);_this.setState({chat:chat},function(){var _this$chatRef$current;// if we add a reaction to the last message we need to scroll down\n// or else the reaction icon might be hidden\nif(msgIndex===chat.length-1&&(_this$chatRef$current=_this.chatRef.current)!==null&&_this$chatRef$current!==void 0&&_this$chatRef$current.state.isNearBottom){var _this$chatRef$current2;(_this$chatRef$current2=_this.chatRef.current)===null||_this$chatRef$current2===void 0?void 0:_this$chatRef$current2.scrollToBottom();}});});socket.on('REC:removeReaction',function(data){var _msg$reactions;var chat=_this.state.chat;var msg=chat.find(function(m){return m.id===data.msgId&&m.timestamp===data.msgTimestamp;});if(!msg||!((_msg$reactions=msg.reactions)!==null&&_msg$reactions!==void 0&&_msg$reactions[data.value])){return;}msg.reactions[data.value]=msg.reactions[data.value].filter(function(id){return id!==data.user;});_this.setState({chat:chat});});socket.on('REC:tsMap',function(data){_this.setState({tsMap:data});_this.syncSubtitle();});socket.on('REC:nameMap',function(data){_this.setState({nameMap:data});});socket.on('REC:pictureMap',function(data){_this.setState({pictureMap:data});});socket.on('REC:lock',function(data){_this.setState({roomLock:data});});socket.on('roster',function(data){_this.setState({participants:data,rosterUpdateTS:Number(new Date())},function(){_this.updateScreenShare();});});socket.on('chatinit',function(data){_this.setState({chat:data,scrollTimestamp:Number(new Date())});});socket.on('playlist',function(data){_this.setState({playlist:data});});socket.on('signalSS',/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(data){var msg,from,pc,_answer$sdp,_sdp,answer;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:process.env.NODE_ENV==='development'&&console.log(data);// Handle messages received from signaling server\nmsg=data.msg;from=data.from;// Determine whether the message came from the sharer or the sharee\npc=data.sharer?_this.screenSharePC:_this.screenHostPC[from];if(!(msg.ice!==undefined)){_context7.next=8;break;}pc.addIceCandidate(new RTCIceCandidate(msg.ice));_context7.next=23;break;case 8:if(!(msg.sdp&&msg.sdp.type==='offer')){_context7.next=22;break;}// console.log('offer');\n// TODO Currently ios/Safari cannot handle this property, so remove it from the offer\n_sdp=msg.sdp.sdp.split('\\n').filter(function(line){return line.trim()!=='a=extmap-allow-mixed';}).join('\\n');msg.sdp.sdp=_sdp;_context7.next=13;return pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));case 13:_context7.next=15;return pc.createAnswer();case 15:answer=_context7.sent;answer.sdp=(_answer$sdp=answer.sdp)===null||_answer$sdp===void 0?void 0:_answer$sdp.replace('useinbandfec=1','useinbandfec=1; stereo=1; maxaveragebitrate=510000');_context7.next=19;return pc.setLocalDescription(answer);case 19:_this.sendSignalSS(from,{sdp:pc.localDescription},!data.sharer);_context7.next=23;break;case 22:if(msg.sdp&&msg.sdp.type==='answer'){pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));}case 23:case\"end\":return _context7.stop();}}},_callee7);}));return function(_x3){return _ref8.apply(this,arguments);};}());socket.on('REC:getRoomState',_this.handleRoomState);window.setInterval(function(){if(_this.state.currentMedia){_this.socket.emit('CMD:ts',_this.getCurrentTime());}},1000);case 30:case\"end\":return _context8.stop();}}},_callee8);}));return function(_x){return _ref4.apply(this,arguments);};}();_this.setupFileShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var files,file,leftVideo,stream;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return openFileSelector();case 2:files=_context9.sent;if(files){_context9.next=5;break;}return _context9.abrupt(\"return\");case 5:file=files[0];leftVideo=document.getElementById('leftVideo');leftVideo.srcObject=null;leftVideo.src=URL.createObjectURL(file);leftVideo.play();//@ts-ignore\nstream=leftVideo.captureStream?leftVideo.captureStream():{};// Can render video to a canvas to resize it, reduce size\nstream.onaddtrack=function(){console.log(stream,stream.getVideoTracks(),stream.getAudioTracks());if(!_this.screenShareStream&&stream.getVideoTracks().length&&stream.getAudioTracks().length){stream.getVideoTracks()[0].onended=_this.stopScreenShare;_this.screenShareStream=stream;_this.socket.emit('CMD:joinScreenShare',{file:true});_this.setState({isScreenSharing:true,isScreenSharingFile:true});stream.onaddtrack=undefined;}};case 12:case\"end\":return _context9.stop();}}},_callee9);}));_this.setupScreenShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var stream;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(!navigator.mediaDevices.getDisplayMedia){_context10.next=8;break;}_context10.next=3;return navigator.mediaDevices.getDisplayMedia({//@ts-ignore\nvideo:{height:720,logicalSurface:true},audio:{autoGainControl:false,channelCount:2,echoCancellation:false,latency:0,noiseSuppression:false,sampleRate:48000,sampleSize:16}});case 3:stream=_context10.sent;stream.getVideoTracks()[0].onended=_this.stopScreenShare;_this.screenShareStream=stream;_this.socket.emit('CMD:joinScreenShare');_this.setState({isScreenSharing:true});case 8:case\"end\":return _context10.stop();}}},_callee10);}));_this.stopScreenShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_this.screenShareStream&&_this.screenShareStream.getTracks().forEach(function(track){track.stop();});_this.screenShareStream=undefined;if(_this.screenSharePC){_this.screenSharePC.close();_this.screenSharePC=undefined;}Object.values(_this.screenHostPC).forEach(function(pc){pc.close();});_this.screenHostPC={};if(_this.state.isScreenSharing){_this.socket.emit('CMD:leaveScreenShare');}_this.setState({isScreenSharing:false,isScreenSharingFile:false});case 7:case\"end\":return _context11.stop();}}},_callee11);}));_this.updateScreenShare=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(){var sharer,selfId,clientIds,pc;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:if(!(!_this.isScreenShare()&&!_this.isFileShare())){_context13.next=2;break;}return _context13.abrupt(\"return\");case 2:sharer=_this.state.participants.find(function(p){return p.isScreenShare;});selfId=getAndSaveClientId();if(sharer&&sharer.clientId===selfId){// We're the sharer, create a connection to each other member\n// Delete and close any connections that aren't in the current member list (maybe someone disconnected)\n// This allows them to rejoin later\nclientIds=new Set(_this.state.participants.map(function(p){return p.clientId;}));Object.entries(_this.screenHostPC).forEach(function(_ref13){var _ref14=_slicedToArray(_ref13,2),key=_ref14[0],value=_ref14[1];if(!clientIds.has(key)){value.close();delete _this.screenHostPC[key];}});_this.state.participants.forEach(function(user){var id=user.clientId;if(id===selfId&&_this.state.isScreenSharingFile){// Don't set up a connection to ourselves if sharing file\nreturn;}if(!_this.screenHostPC[id]){var _this$screenShareStre;// Set up the RTCPeerConnection for sharing media to each member\nvar pc=new RTCPeerConnection({iceServers:iceServers()});_this.screenHostPC[id]=pc;(_this$screenShareStre=_this.screenShareStream)===null||_this$screenShareStre===void 0?void 0:_this$screenShareStre.getTracks().forEach(function(track){if(_this.screenShareStream!=null){pc.addTrack(track,_this.screenShareStream);}});pc.onicecandidate=function(event){// We generated an ICE candidate, send it to peer\nif(event.candidate){_this.sendSignalSS(id,{ice:event.candidate},true);}};pc.onnegotiationneeded=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(){var offer;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return pc.createOffer();case 2:offer=_context12.sent;_context12.next=5;return pc.setLocalDescription(offer);case 5:_this.sendSignalSS(id,{sdp:pc.localDescription},true);case 6:case\"end\":return _context12.stop();}}},_callee12);}));}});}// We're a watcher, establish connection to sharer\n// If screensharing, sharer also does this\n// If filesharing, sharer does not do this since we use leftVideo\nif(sharer&&!_this.screenSharePC&&!_this.state.isScreenSharingFile){pc=new RTCPeerConnection({iceServers:iceServers()});_this.screenSharePC=pc;pc.onicecandidate=function(event){// We generated an ICE candidate, send it to peer\nif(event.candidate){_this.sendSignalSS(sharer.clientId,{ice:event.candidate});}};pc.ontrack=function(event){// Mount the stream from peer\n// console.log(stream);\nvar leftVideo=document.getElementById('leftVideo');if(leftVideo){leftVideo.src='';leftVideo.srcObject=event.streams[0];_this.doPlay();}};}case 6:case\"end\":return _context13.stop();}}},_callee13);}));_this.startVBrowser=/*#__PURE__*/function(){var _ref16=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee14(rcToken,options){var user,uid,token;return _regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:// user.uid is the public user identifier\n// user.getIdToken() is the secret access token we can send to the server to prove identity\nuser=_this.props.user;uid=user===null||user===void 0?void 0:user.uid;_context14.next=4;return user===null||user===void 0?void 0:user.getIdToken();case 4:token=_context14.sent;_this.socket.emit('CMD:startVBrowser',{options:options,uid:uid,token:token,rcToken:rcToken});case 6:case\"end\":return _context14.stop();}}},_callee14);}));return function(_x4,_x5){return _ref16.apply(this,arguments);};}();_this.stopVBrowser=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee15(){return _regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:_this.socket.emit('CMD:stopVBrowser');case 1:case\"end\":return _context15.stop();}}},_callee15);}));_this.changeController=/*#__PURE__*/function(){var _ref18=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee16(_e,data){return _regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:// console.log(data);\n_this.socket.emit('CMD:changeController',data.value);case 1:case\"end\":return _context16.stop();}}},_callee16);}));return function(_x6,_x7){return _ref18.apply(this,arguments);};}();_this.sendSignalSS=/*#__PURE__*/function(){var _ref19=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee17(to,data,sharer){return _regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:// console.log('sendSS', to, data);\n_this.socket.emit('signalSS',{to:to,msg:data,sharer:sharer});case 1:case\"end\":return _context17.stop();}}},_callee17);}));return function(_x8,_x9,_x10){return _ref19.apply(this,arguments);};}();_this.isYouTube=function(){return getMediaType(_this.state.currentMedia)==='youtube';};_this.isVideo=function(){return getMediaType(_this.state.currentMedia)==='video';};_this.isScreenShare=function(){return _this.state.currentMedia.startsWith('screenshare://');};_this.isFileShare=function(){return _this.state.currentMedia.startsWith('fileshare://');};_this.isVBrowser=function(){return _this.state.currentMedia.startsWith('vbrowser://');};_this.isHttp=function(){return _this.state.currentMedia.startsWith('http');};_this.getVBrowserPass=function(){return _this.state.currentMedia.replace('vbrowser://','').split('@')[0];};_this.getVBrowserHost=function(){return _this.state.currentMedia.replace('vbrowser://','').split('@')[1];};_this.getCurrentTime=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo===null||leftVideo===void 0?void 0:leftVideo.currentTime;}if(_this.isYouTube()){var _this$watchPartyYTPla2;return(_this$watchPartyYTPla2=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla2===void 0?void 0:_this$watchPartyYTPla2.getCurrentTime();}};_this.getDuration=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo.duration;}if(_this.isYouTube()){var _this$watchPartyYTPla3;return(_this$watchPartyYTPla3=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla3===void 0?void 0:_this$watchPartyYTPla3.getDuration();}return 0;};_this.isPauseDisabled=function(){return _this.isScreenShare()||_this.isVBrowser();};_this.isMuted=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo===null||leftVideo===void 0?void 0:leftVideo.muted;}if(_this.isYouTube()){var _this$watchPartyYTPla4;return(_this$watchPartyYTPla4=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla4===void 0?void 0:_this$watchPartyYTPla4.isMuted();}return false;};_this.isSubtitled=function(){if(_this.isVideo()){return Boolean(_this.state.currentSubtitle);}if(_this.isYouTube()){try{var _this$watchPartyYTPla5;var current=(_this$watchPartyYTPla5=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla5===void 0?void 0:_this$watchPartyYTPla5.getOption('captions','track');return Boolean(current&&current.languageCode);}catch(e){console.warn(e);return false;}}return false;};_this.jumpToLeader=function(){// Jump to the leader's position\nvar maxTS=_this.getLeaderTime();if(maxTS>0){console.log('jump to leader at ',maxTS);_this.doSeek(maxTS);}};_this.doSrc=/*#__PURE__*/function(){var _ref20=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee18(src,time){var leftVideo,_this$watchPartyYTPla6,url,videoId,altVideoId;return _regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:console.log('doSrc',src,time);if(!(_this.isScreenShare()||_this.isFileShare()||_this.isVBrowser())){_context18.next=3;break;}return _context18.abrupt(\"return\");case 3:if(_this.isVideo()){leftVideo=document.getElementById('leftVideo');if(leftVideo){leftVideo.srcObject=null;leftVideo.src=src;leftVideo.currentTime=time;// Clear subtitles\nleftVideo.innerHTML='';}}if(_this.isYouTube()){url=new window.URL(src);// Standard link https://www.youtube.com/watch?v=ID\nvideoId=querystring.parse(url.search.substring(1))['v'];// Link shortener https://youtu.be/ID\naltVideoId=src.split('/').slice(-1)[0];(_this$watchPartyYTPla6=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla6===void 0?void 0:_this$watchPartyYTPla6.cueVideoById(videoId||altVideoId,time);}case 5:case\"end\":return _context18.stop();}}},_callee18);}));return function(_x11,_x12){return _ref20.apply(this,arguments);};}();_this.doPlay=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee20(){var canAutoplay;return _regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.t0=_this.state.isAutoPlayable;if(_context20.t0){_context20.next=5;break;}_context20.next=4;return testAutoplay();case 4:_context20.t0=_context20.sent;case 5:canAutoplay=_context20.t0;_this.setState({currentMediaPaused:false,isAutoPlayable:canAutoplay},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee19(){var leftVideo,lv,hls;return _regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:if(!_this.isVideo()){_context19.next=14;break;}leftVideo=document.getElementById('leftVideo');//check for HLS\nlv=leftVideo===null||leftVideo===void 0?void 0:leftVideo.src.split('.');if(lv[lv.length-1]==='m3u8'&&!(leftVideo!==null&&leftVideo!==void 0&&leftVideo.canPlayType('application/vnd.apple.mpegurl'))){hls=new window.Hls();hls.loadSource(leftVideo.src);hls.attachMedia(leftVideo);}_context19.prev=4;if(_this.state.isAutoPlayable){_this.setMute(false);}else{_this.setMute(true);}_context19.next=8;return leftVideo===null||leftVideo===void 0?void 0:leftVideo.play();case 8:_context19.next=14;break;case 10:_context19.prev=10;_context19.t0=_context19[\"catch\"](4);console.warn(_context19.t0);if(_context19.t0.name==='NotSupportedError'){_this.setState({loading:false,nonPlayableMedia:true});}case 14:if(_this.isYouTube()){setTimeout(function(){var _this$watchPartyYTPla7;console.log('play yt');(_this$watchPartyYTPla7=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla7===void 0?void 0:_this$watchPartyYTPla7.playVideo();},200);}case 15:case\"end\":return _context19.stop();}}},_callee19,null,[[4,10]]);})));case 7:case\"end\":return _context20.stop();}}},_callee20);}));_this.doPause=function(){_this.setState({currentMediaPaused:true},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee21(){var leftVideo,_this$watchPartyYTPla8;return _regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:if(_this.isVideo()){leftVideo=document.getElementById('leftVideo');leftVideo.pause();}if(_this.isYouTube()){console.log('pause');(_this$watchPartyYTPla8=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla8===void 0?void 0:_this$watchPartyYTPla8.pauseVideo();}case 2:case\"end\":return _context21.stop();}}},_callee21);})));};_this.doSeek=function(time){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');leftVideo.currentTime=time;}if(_this.isYouTube()){var _this$watchPartyYTPla9;(_this$watchPartyYTPla9=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla9===void 0?void 0:_this$watchPartyYTPla9.seekTo(time,true);}};_this.togglePlay=function(){if(_this.isPauseDisabled()){return;}var shouldPlay=true;if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');shouldPlay=leftVideo.paused||leftVideo.ended;}else if(_this.isYouTube()){var _this$watchPartyYTPla10,_window$YT6;shouldPlay=((_this$watchPartyYTPla10=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla10===void 0?void 0:_this$watchPartyYTPla10.getPlayerState())===((_window$YT6=window.YT)===null||_window$YT6===void 0?void 0:_window$YT6.PlayerState.PAUSED)||_this.getCurrentTime()===_this.getDuration();}if(shouldPlay){_this.socket.emit('CMD:play');_this.doPlay();}else{_this.socket.emit('CMD:pause');_this.doPause();}};_this.onSeek=function(e,time){var target=time;if(e){var rect=e.target.getBoundingClientRect();var x=e.clientX-rect.left;var max=rect.width;target=x/max*_this.getDuration();}target=Math.max(target,0);_this.doSeek(target);_this.socket.emit('CMD:seek',target);};_this.onFullScreenChange=function(){_this.setState({fullScreen:Boolean(document.fullscreenElement)});};_this.onKeydown=function(e){if(!document.activeElement||document.activeElement.tagName==='BODY'){if(e.key===' '){e.preventDefault();_this.togglePlay();}else if(e.key==='ArrowRight'){_this.onSeek(null,_this.getCurrentTime()+10);}else if(e.key==='ArrowLeft'){_this.onSeek(null,_this.getCurrentTime()-10);}else if(e.key==='c'){_this.toggleSubtitle();}else if(e.key==='t'){_this.fullScreen(false);}else if(e.key==='f'){_this.fullScreen(true);}else if(e.key==='m'){_this.toggleMute();}}};_this.fullScreen=/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee22(bVideoOnly){var container,bChangeElements;return _regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:container=document.getElementById('theaterContainer');if(bVideoOnly||isMobile()){if(_this.isVBrowser()&&!isMobile()){// Can't really control the VBrowser on mobile anyway, so just fullscreen the video\n// https://github.com/howardchung/watchparty/issues/208\ncontainer=document.getElementById('leftVideoParent');}else{container=document.getElementById(_this.isYouTube()?'leftYt':'leftVideo');}}if(!(!container.requestFullscreen&&container.webkitEnterFullScreen)){_context22.next=5;break;}// e.g. iPhone doesn't allow requestFullscreen\ncontainer.webkitEnterFullscreen();return _context22.abrupt(\"return\");case 5:if(document.fullscreenElement){_context22.next=9;break;}_context22.next=8;return container.requestFullscreen();case 8:return _context22.abrupt(\"return\");case 9:bChangeElements=document.fullscreenElement!==container;_context22.next=12;return document.exitFullscreen();case 12:if(!bChangeElements){_context22.next=15;break;}_context22.next=15;return container.requestFullscreen();case 15:case\"end\":return _context22.stop();}}},_callee22);}));return function(_x13){return _ref24.apply(this,arguments);};}();_this.toggleMute=function(){_this.setMute(!_this.isMuted());};_this.setMute=function(muted){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');if(leftVideo){leftVideo.muted=muted;}var audio=document.getElementById('iPhoneAudio');if(audio){audio.muted=muted;}}if(_this.isYouTube()){if(muted){var _this$watchPartyYTPla11;(_this$watchPartyYTPla11=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla11===void 0?void 0:_this$watchPartyYTPla11.mute();}else{var _this$watchPartyYTPla12;(_this$watchPartyYTPla12=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla12===void 0?void 0:_this$watchPartyYTPla12.unMute();}}};_this.setVolume=function(volume){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');leftVideo.volume=volume;}if(_this.isYouTube()){var _this$watchPartyYTPla13;(_this$watchPartyYTPla13=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla13===void 0?void 0:_this$watchPartyYTPla13.setVolume(volume*100);}};_this.getVolume=function(){if(_this.isVideo()){var leftVideo=document.getElementById('leftVideo');return leftVideo.volume;}if(_this.isYouTube()){var _this$watchPartyYTPla14;var volume=(_this$watchPartyYTPla14=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla14===void 0?void 0:_this$watchPartyYTPla14.getVolume();return volume/100;}};_this.loadSubtitles=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee23(){var leftVideo,subtitleSrc,response,buffer,url,track;return _regeneratorRuntime.wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:leftVideo=document.getElementById('leftVideo');if(_this.isSubtitled()){_context23.next=5;break;}leftVideo.innerHTML='';_context23.next=24;break;case 5:// Clear subtitles and put new ones in\nleftVideo.innerHTML='';subtitleSrc=_this.state.currentSubtitle;if(!subtitleSrc){_context23.next=24;break;}_context23.next=10;return window.fetch(subtitleSrc);case 10:response=_context23.sent;_context23.next=13;return response.arrayBuffer();case 13:buffer=_context23.sent;_context23.next=16;return toWebVTT(new Blob([buffer]));case 16:url=_context23.sent;track=document.createElement('track');track.kind='captions';track.label='English';track.srclang='en';track.src=url;leftVideo.appendChild(track);leftVideo.textTracks[0].mode='showing';case 24:case\"end\":return _context23.stop();}}},_callee23);}));_this.syncSubtitle=function(){var sharer=_this.state.participants.find(function(p){return p.isScreenShare;});if(!sharer||sharer.id===_this.socket.id){return;}// When sharing, our timestamp doesn't match the subtitles so adjust them\n// For each cue, subtract the videoTS of the sharer, then add our own\nvar leftVideo=document.getElementById('leftVideo');var track=leftVideo===null||leftVideo===void 0?void 0:leftVideo.textTracks[0];var offset=leftVideo.currentTime-_this.state.tsMap[sharer.id];if(track&&track.cues&&offset){for(var i=0;i<track.cues.length;i++){var _track$cues;var cue=track===null||track===void 0?void 0:(_track$cues=track.cues)===null||_track$cues===void 0?void 0:_track$cues[i];if(!cue){continue;}// console.log(cue.text, offset, (cue as any).origStart, (cue as any).origEnd);\nif(!cue.origStart){cue.origStart=cue.startTime;cue.origEnd=cue.endTime;}cue.startTime=cue.origStart+offset;cue.endTime=cue.origEnd+offset;}}};_this.toggleSubtitle=function(){if(_this.isVideo()){_this.setState({isSubtitleModalOpen:true});}if(_this.isYouTube()){var isSubtitled=_this.isSubtitled();// console.log(isSubtitled);\nif(isSubtitled){var _this$watchPartyYTPla15;// BUG this doesn't actually set the value so subtitles can't be toggled off\n(_this$watchPartyYTPla15=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla15===void 0?void 0:_this$watchPartyYTPla15.setOption('captions','track',{});}else{var _this$watchPartyYTPla16,_this$watchPartyYTPla17,_this$watchPartyYTPla18;(_this$watchPartyYTPla16=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla16===void 0?void 0:_this$watchPartyYTPla16.setOption('captions','reload',true);var tracks=(_this$watchPartyYTPla17=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla17===void 0?void 0:_this$watchPartyYTPla17.getOption('captions','tracklist');(_this$watchPartyYTPla18=_this.watchPartyYTPlayer)===null||_this$watchPartyYTPla18===void 0?void 0:_this$watchPartyYTPla18.setOption('captions','track',tracks===null||tracks===void 0?void 0:tracks[0]);}}};_this.setMedia=function(_e,data){_this.socket.emit('CMD:host',data.value);};_this.playlistAdd=function(_e,data){_this.socket.emit('CMD:playlistAdd',data.value);};_this.playlistMove=function(index,toIndex){_this.socket.emit('CMD:playlistMove',{index:index,toIndex:toIndex});};_this.playlistDelete=function(index){_this.socket.emit('CMD:playlistDelete',index);};_this.launchMultiSelect=function(data){_this.setState({multiStreamSelection:data});};_this.resetMultiSelect=function(){_this.setState({multiStreamSelection:undefined});};_this.updateName=function(_e,data){_this.setState({myName:data.value});_this.socket.emit('CMD:name',data.value);window.localStorage.setItem('watchparty-username',data.value);};_this.updatePicture=function(url){_this.setState({myPicture:url});_this.socket.emit('CMD:picture',url);};_this.updateUid=/*#__PURE__*/function(){var _ref26=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee24(user){var uid,token;return _regeneratorRuntime.wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:uid=user.uid;_context24.next=3;return user.getIdToken();case 3:token=_context24.sent;_this.socket.emit('CMD:uid',{uid:uid,token:token});case 5:case\"end\":return _context24.stop();}}},_callee24);}));return function(_x14){return _ref26.apply(this,arguments);};}();_this.getMediaDisplayName=function(input){if(!input){return'';}// Show the whole URL for youtube\nif(getMediaType(input)==='youtube'){return input;}if(input.startsWith('screenshare://')){var _sharer$id;var sharer=_this.state.participants.find(function(user){return user.isScreenShare;});return _this.state.nameMap[(_sharer$id=sharer===null||sharer===void 0?void 0:sharer.id)!==null&&_sharer$id!==void 0?_sharer$id:'']+\"'s screen\";}if(input.startsWith('fileshare://')){var _sharer$id2;var _sharer=_this.state.participants.find(function(user){return user.isScreenShare;});return _this.state.nameMap[(_sharer$id2=_sharer===null||_sharer===void 0?void 0:_sharer.id)!==null&&_sharer$id2!==void 0?_sharer$id2:'']+\"'s file\";}if(input.startsWith('vbrowser://')){return'Virtual Browser'+(_this.state.isVBrowserLarge?'+':'');}if(input.includes('/stream?torrent=magnet')){var search=new URL(input).search;var magnetUrl=querystring.parse(search.substring(1)).torrent;var magnetParsed=querystring.parse(magnetUrl);return magnetParsed.dn;}// Get the filename out of the URL\nreturn input;};_this.getFileName=function(input){return input.split('/').slice(-1)[0];};_this.setLoadingFalse=function(){_this.setState({loading:false});};_this.setRoomLock=/*#__PURE__*/function(){var _ref27=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee25(locked){var _this$props$user,_this$props$user2;var uid,token;return _regeneratorRuntime.wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:uid=(_this$props$user=_this.props.user)===null||_this$props$user===void 0?void 0:_this$props$user.uid;_context25.next=3;return(_this$props$user2=_this.props.user)===null||_this$props$user2===void 0?void 0:_this$props$user2.getIdToken();case 3:token=_context25.sent;_this.socket.emit('CMD:lock',{uid:uid,token:token,locked:locked});case 5:case\"end\":return _context25.stop();}}},_callee25);}));return function(_x15){return _ref27.apply(this,arguments);};}();_this.haveLock=function(){var _this$props$user3;if(!_this.state.roomLock){return true;}return((_this$props$user3=_this.props.user)===null||_this$props$user3===void 0?void 0:_this$props$user3.uid)===_this.state.roomLock;};_this.setIsChatDisabled=function(val){return _this.setState({isChatDisabled:val});};_this.clearChat=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee26(){var _this$props$user4,_this$props$user5;var uid,token;return _regeneratorRuntime.wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:uid=(_this$props$user4=_this.props.user)===null||_this$props$user4===void 0?void 0:_this$props$user4.uid;_context26.next=3;return(_this$props$user5=_this.props.user)===null||_this$props$user5===void 0?void 0:_this$props$user5.getIdToken();case 3:token=_context26.sent;_this.socket.emit('CMD:deleteChatMessages',{uid:uid,token:token});case 5:case\"end\":return _context26.stop();}}},_callee26);}));_this.getLeaderTime=function(){if(_this.state.participants.length>2){return calculateMedian(Object.values(_this.state.tsMap));}return Math.max.apply(Math,_toConsumableArray(Object.values(_this.state.tsMap)));};_this.onVideoEnded=function(){var _this$state$currentMe;_this.socket.emit('CMD:playlistNext',_this.state.currentMedia);// Play next\nif((_this$state$currentMe=_this.state.currentMedia)!==null&&_this$state$currentMe!==void 0&&_this$state$currentMe.includes('/stream?torrent=magnet')){var url=new URL(_this.state.currentMedia);var fileIndex=url.searchParams.get('fileIndex');if(fileIndex!=null){url.searchParams.set('fileIndex',(Number(fileIndex)+1).toString());_this.setMedia(null,{value:url.toString()});}}};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee27(){var canAutoplay;return _regeneratorRuntime.wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:document.onfullscreenchange=this.onFullScreenChange;document.onkeydown=this.onKeydown;// Send heartbeat to the server\nthis.heartbeat=window.setInterval(function(){window.fetch(serverPath+'/ping');},10*60*1000);_context27.next=5;return testAutoplay();case 5:canAutoplay=_context27.sent;this.setState({isAutoPlayable:canAutoplay});this.loadSettings();this.loadYouTube();this.init();case 10:case\"end\":return _context27.stop();}}},_callee27,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"componentWillUnmount\",value:function componentWillUnmount(){document.removeEventListener('fullscreenchange',this.onFullScreenChange);document.removeEventListener('keydown',this.onKeydown);window.clearInterval(this.heartbeat);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.user&&!prevProps.user){this.loadSignInData();}}},{key:\"render\",value:function render(){var _this2=this,_this$socket;var sharer=this.state.participants.find(function(p){return p.isScreenShare;});var controls=/*#__PURE__*/_jsx(Controls,{togglePlay:this.togglePlay,onSeek:this.onSeek,fullScreen:this.fullScreen,toggleMute:this.toggleMute,toggleSubtitle:this.toggleSubtitle,setVolume:this.setVolume,jumpToLeader:this.jumpToLeader,paused:this.state.currentMediaPaused,muted:this.isMuted(),subtitled:this.isSubtitled(),currentTime:this.getCurrentTime(),duration:this.getDuration(),disabled:!this.haveLock(),leaderTime:this.isHttp()?this.getLeaderTime():undefined,isPauseDisabled:this.isPauseDisabled()},this.state.controlsTimestamp);var subscribeButton=/*#__PURE__*/_jsx(SubscribeButton,{user:this.props.user,isSubscriber:this.props.isSubscriber,isCustomer:this.props.isCustomer});var displayRightContent=this.state.showRightBar||this.state.fullScreen;var rightBar=/*#__PURE__*/_jsxs(Grid.Column,{width:displayRightContent?4:1,style:{display:'flex',flexDirection:'column'},className:\"\".concat(this.state.fullScreen?'fullHeightColumnFullscreen':'fullHeightColumn'),children:[/*#__PURE__*/_jsx(Input,{inverted:true,fluid:true,label:'My name is:',value:this.state.myName,onChange:this.updateName,style:{visibility:displayRightContent?'':'hidden'},icon:/*#__PURE__*/_jsx(Icon,{onClick:function onClick(){return _this2.updateName(null,{value:generateName()});},name:\"refresh\",inverted:true,circular:true,link:true})}),/*#__PURE__*/_jsxs(Menu,{inverted:true,widths:3,style:{marginTop:'4px',marginBottom:'4px',visibility:displayRightContent?'':'hidden'},children:[/*#__PURE__*/_jsxs(Menu.Item,{name:\"chat\",active:this.state.currentTab==='chat',onClick:function onClick(){_this2.setState({currentTab:'chat',unreadCount:0});},as:\"a\",children:[\"Chat\",this.state.unreadCount>0&&/*#__PURE__*/_jsx(Label,{circular:true,color:\"red\",children:this.state.unreadCount})]}),/*#__PURE__*/_jsxs(Menu.Item,{name:\"people\",active:this.state.currentTab==='people',onClick:function onClick(){return _this2.setState({currentTab:'people'});},as:\"a\",children:[\"People\",/*#__PURE__*/_jsx(Label,{circular:true,color:getColorForString(this.state.participants.length.toString()),children:this.state.participants.length})]}),/*#__PURE__*/_jsx(Menu.Item,{name:\"settings\",active:this.state.currentTab==='settings',onClick:function onClick(){return _this2.setState({currentTab:'settings'});},as:\"a\",children:\"Settings\"})]}),/*#__PURE__*/_jsx(Chat,{chat:this.state.chat,nameMap:this.state.nameMap,pictureMap:this.state.pictureMap,socket:this.socket,scrollTimestamp:this.state.scrollTimestamp,getMediaDisplayName:this.getMediaDisplayName,hide:this.state.currentTab!=='chat'||!displayRightContent,isChatDisabled:this.state.isChatDisabled,owner:this.state.owner,user:this.props.user,ref:this.chatRef}),this.state.state==='connected'&&/*#__PURE__*/_jsx(VideoChat,{socket:this.socket,participants:this.state.participants,nameMap:this.state.nameMap,pictureMap:this.state.pictureMap,tsMap:this.state.tsMap,rosterUpdateTS:this.state.rosterUpdateTS,hide:this.state.currentTab!=='people'||!displayRightContent,owner:this.state.owner,user:this.props.user}),/*#__PURE__*/_jsx(SettingsTab,{hide:this.state.currentTab!=='settings'||!displayRightContent,user:this.props.user,roomLock:this.state.roomLock,setRoomLock:this.setRoomLock,socket:this.socket,isSubscriber:this.props.isSubscriber,roomId:this.state.roomId,isChatDisabled:this.state.isChatDisabled,setIsChatDisabled:this.setIsChatDisabled,owner:this.state.owner,setOwner:this.setOwner,vanity:this.state.vanity,setVanity:this.setVanity,roomLink:this.state.roomLink,password:this.state.password,setPassword:this.setPassword,clearChat:this.clearChat,roomTitle:this.state.roomTitle,setRoomTitle:this.setRoomTitle,roomDescription:this.state.roomDescription,setRoomDescription:this.setRoomDescription,roomTitleColor:this.state.roomTitleColor,setRoomTitleColor:this.setRoomTitleColor,mediaPath:this.state.mediaPath,setMediaPath:this.setMediaPath})]});return/*#__PURE__*/_jsxs(React.Fragment,{children:[!this.state.isAutoPlayable&&/*#__PURE__*/_jsx(Modal,{inverted:true,basic:true,open:true,children:/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center'},children:/*#__PURE__*/_jsxs(Button,{primary:true,size:\"large\",onClick:function onClick(){_this2.setState({isAutoPlayable:true});_this2.setMute(false);_this2.setVolume(1);},icon:true,labelPosition:\"left\",children:[/*#__PURE__*/_jsx(Icon,{name:\"volume up\"}),\"Click to unmute\"]})})}),this.state.multiStreamSelection&&/*#__PURE__*/_jsx(MultiStreamModal,{streams:this.state.multiStreamSelection,setMedia:this.setMedia,resetMultiSelect:this.resetMultiSelect}),this.state.isVBrowserModalOpen&&/*#__PURE__*/_jsx(VBrowserModal,{isSubscriber:this.props.isSubscriber,subscribeButton:subscribeButton,closeModal:function closeModal(){return _this2.setState({isVBrowserModalOpen:false});},startVBrowser:this.startVBrowser,user:this.props.user,beta:this.props.beta}),this.state.isScreenShareModalOpen&&/*#__PURE__*/_jsx(ScreenShareModal,{closeModal:function closeModal(){return _this2.setState({isScreenShareModalOpen:false});},startScreenShare:this.setupScreenShare}),this.state.isFileShareModalOpen&&/*#__PURE__*/_jsx(FileShareModal,{closeModal:function closeModal(){return _this2.setState({isFileShareModalOpen:false});},startFileShare:this.setupFileShare}),this.state.isSubtitleModalOpen&&/*#__PURE__*/_jsx(SubtitleModal,{closeModal:function closeModal(){return _this2.setState({isSubtitleModalOpen:false});},socket:this.socket,currentSubtitle:this.state.currentSubtitle,src:this.state.currentMedia,haveLock:this.haveLock,getMediaDisplayName:this.getMediaDisplayName,beta:this.props.beta}),this.state.error&&/*#__PURE__*/_jsx(ErrorModal,{error:this.state.error}),this.state.isErrorAuth&&/*#__PURE__*/_jsx(PasswordModal,{savedPasswords:this.state.savedPasswords,roomId:this.state.roomId}),this.state.errorMessage&&/*#__PURE__*/_jsx(Message,{negative:true,header:\"Error\",content:this.state.errorMessage,style:{position:'fixed',bottom:'10px',right:'10px',zIndex:1000}}),this.state.successMessage&&/*#__PURE__*/_jsx(Message,{positive:true,header:\"Success\",content:this.state.successMessage,style:{position:'fixed',bottom:'10px',right:'10px',zIndex:1000}}),/*#__PURE__*/_jsx(TopBar,{user:this.props.user,isCustomer:this.props.isCustomer,isSubscriber:this.props.isSubscriber,roomTitle:this.state.roomTitle,roomDescription:this.state.roomDescription,roomTitleColor:this.state.roomTitleColor}),/*#__PURE__*/_jsx(Grid,{stackable:true,celled:\"internally\",children:/*#__PURE__*/_jsxs(Grid.Row,{id:\"theaterContainer\",children:[/*#__PURE__*/_jsxs(Grid.Column,{width:this.state.showRightBar?12:15,className:this.state.fullScreen?'fullHeightColumnFullscreen':'fullHeightColumn',children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',height:'100%'},children:[!this.state.fullScreen&&/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(ComboBox,{setMedia:this.setMedia,playlistAdd:this.playlistAdd,playlistDelete:this.playlistDelete,playlistMove:this.playlistMove,currentMedia:this.state.currentMedia,getMediaDisplayName:this.getMediaDisplayName,launchMultiSelect:this.launchMultiSelect,streamPath:this.props.streamPath,mediaPath:this.state.mediaPath,disabled:!this.haveLock(),playlist:this.state.playlist}),/*#__PURE__*/_jsx(Separator,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"mobileStack\",style:{display:'flex',gap:'4px'},children:[this.screenShareStream&&/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",icon:true,labelPosition:\"left\",color:\"red\",onClick:this.stopScreenShare,disabled:(sharer===null||sharer===void 0?void 0:sharer.id)!==((_this$socket=this.socket)===null||_this$socket===void 0?void 0:_this$socket.id),children:[/*#__PURE__*/_jsx(Icon,{name:\"cancel\"}),\"Stop Share\"]}),!this.screenShareStream&&!sharer&&!this.isVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Share a tab or an application. Make sure to check \\\"Share audio\\\" for best results.\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",color:'instagram',onClick:function onClick(){_this2.setState({isScreenShareModalOpen:true});},children:[/*#__PURE__*/_jsx(Icon,{name:'slideshare'}),\"Screenshare\"]})}),!this.screenShareStream&&!sharer&&!this.isVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Launch a shared virtual browser\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",color:\"green\",onClick:function onClick(){_this2.setState({isVBrowserModalOpen:true});},children:[/*#__PURE__*/_jsx(Icon,{name:\"desktop\"}),\"VBrowser\"]})}),this.isVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Choose the person controlling the VBrowser\",trigger:/*#__PURE__*/_jsx(Dropdown,{icon:\"keyboard\",labeled:true,className:\"icon\",style:{height:'36px'},button:true,value:this.state.controller,placeholder:\"No controller\",clearable:true,onChange:this.changeController,selection:true,disabled:!this.haveLock(),options:this.state.participants.map(function(p){return{text:_this2.state.nameMap[p.id]||p.id,value:p.id};})})}),this.isVBrowser()&&/*#__PURE__*/_jsx(Dropdown,{icon:\"desktop\",labeled:true,className:\"icon\",style:{height:'36px'},button:true,disabled:!this.haveLock(),value:this.state.vBrowserResolution,onChange:function onChange(_e,data){return _this2.setState({vBrowserResolution:data.value});},selection:true,options:[{text:'1080p (Plus only)',value:'1920x1080@30',disabled:!this.state.isVBrowserLarge},{text:'720p',value:'1280x720@30'},{text:'576p',value:'1024x576@60'},{text:'486p',value:'864x486@60'},{text:'360p',value:'640x360@60'}]}),this.isVBrowser()&&/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",icon:true,labelPosition:\"left\",color:\"red\",disabled:!this.haveLock(),onClick:this.stopVBrowser,children:[/*#__PURE__*/_jsx(Icon,{name:\"cancel\"}),\"Stop VBrowser\"]}),!this.screenShareStream&&!sharer&&!this.isVBrowser()&&/*#__PURE__*/_jsx(Popup,{content:\"Stream your own video file\",trigger:/*#__PURE__*/_jsxs(Button,{fluid:true,className:\"toolButton\",disabled:!this.haveLock(),icon:true,labelPosition:\"left\",onClick:function onClick(){_this2.setState({isFileShareModalOpen:true});},children:[/*#__PURE__*/_jsx(Icon,{name:\"file\"}),\"File\"]})}),false&&/*#__PURE__*/_jsx(SearchComponent,{setMedia:this.setMedia,playlistAdd:this.playlistAdd,type:'youtube',streamPath:this.props.streamPath,disabled:!this.haveLock()}),Boolean(this.props.streamPath)&&/*#__PURE__*/_jsx(SearchComponent,{setMedia:this.setMedia,playlistAdd:this.playlistAdd,type:'stream',streamPath:this.props.streamPath,launchMultiSelect:this.launchMultiSelect,disabled:!this.haveLock()})]}),/*#__PURE__*/_jsx(Separator,{})]}),/*#__PURE__*/_jsx(\"div\",{style:{flexGrow:1},children:/*#__PURE__*/_jsxs(\"div\",{id:\"playerContainer\",children:[(this.state.loading||!this.state.currentMedia||this.state.nonPlayableMedia)&&/*#__PURE__*/_jsxs(\"div\",{id:\"loader\",className:\"videoContent\",style:{display:'flex',alignItems:'center',justifyContent:'center'},children:[this.state.loading&&/*#__PURE__*/_jsx(Dimmer,{active:true,children:/*#__PURE__*/_jsx(Loader,{children:this.isVBrowser()?'Launching virtual browser. This can take up to a minute.':''})}),!this.state.loading&&!this.state.currentMedia&&/*#__PURE__*/_jsx(Message,{color:\"yellow\",icon:\"hand point up\",header:\"You're not watching anything!\",content:\"Pick something to watch above.\"}),!this.state.loading&&this.state.nonPlayableMedia&&/*#__PURE__*/_jsx(Message,{color:\"red\",icon:\"frown\",header:\"It doesn't look like this is a media file!\",content:\"Maybe you meant to launch a VBrowser if you're trying to visit a web page?\"})]}),/*#__PURE__*/_jsx(\"iframe\",{style:{display:this.isYouTube()&&!this.state.loading?'block':'none'},title:\"YouTube\",id:\"leftYt\",className:\"videoContent\",allowFullScreen:true,frameBorder:\"0\",allow:\"autoplay\",src:\"https://www.youtube.com/embed/?enablejsapi=1&controls=0&rel=0\"}),this.isVBrowser()&&this.getVBrowserPass()&&this.getVBrowserHost()?/*#__PURE__*/_jsx(VBrowser,{username:this.socket.id,password:this.getVBrowserPass(),hostname:this.getVBrowserHost(),controlling:this.state.controller===this.socket.id,setLoadingFalse:this.setLoadingFalse,resolution:this.state.vBrowserResolution,doPlay:this.doPlay,setResolution:function setResolution(data){return _this2.setState({vBrowserResolution:data});}}):/*#__PURE__*/_jsx(\"video\",{style:{display:this.isVideo()&&!this.state.loading||this.state.fullScreen?'block':'none',width:'100%',maxHeight:'calc(100vh - 62px - 36px - 36px - 8px - 41px - 16px)'},id:\"leftVideo\",onEnded:this.onVideoEnded,playsInline:true})]})}),this.state.currentMedia&&controls,Boolean(this.state.total)&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Progress,{size:\"tiny\",color:\"green\",inverted:true,value:this.state.downloaded,total:this.state.total// indicating\n,label:Math.min(this.state.downloaded/this.state.total*100,100).toFixed(2)+'% - '+formatSpeed(this.state.speed)+' - '+this.state.connections+' connections'})})]}),/*#__PURE__*/_jsx(Button,{style:{position:'absolute',top:'50%',right:'calc(0% - 18px)',zIndex:900},circular:true,size:\"mini\",icon:this.state.showRightBar?'angle right':'angle left',onClick:function onClick(){return _this2.setState({showRightBar:!_this2.state.showRightBar});}})]}),rightBar]})})]});}}]);return App;}(React.Component);export{App as default};export var Separator=function Separator(){return/*#__PURE__*/_jsx(\"div\",{style:{height:'4px',flexShrink:0}});};","map":{"version":3,"sources":["/home/runner/work/watchparty/watchparty/src/components/App/App.tsx"],"names":["querystring","axios","React","Button","Dimmer","Dropdown","Grid","Icon","Input","Loader","Message","Popup","Progress","Menu","Modal","Label","io","default","toWebVTT","formatSpeed","getMediaType","iceServers","isMobile","serverPath","testAutoplay","openFileSelector","getAndSaveClientId","calculateMedian","getUserImage","getColorForString","generateName","Chat","TopBar","VBrowser","VideoChat","getCurrentSettings","MultiStreamModal","ComboBox","SearchComponent","Controls","VBrowserModal","SettingsTab","ErrorModal","PasswordModal","SubscribeButton","ScreenShareModal","FileShareModal","SubtitleModal","window","watchparty","ourStream","undefined","videoRefs","videoPCs","App","state","currentMedia","currentMediaPaused","currentSubtitle","participants","rosterUpdateTS","Number","Date","chat","playlist","tsMap","nameMap","pictureMap","myName","myPicture","loading","scrollTimestamp","unreadCount","fullScreen","controlsTimestamp","watchOptions","isScreenSharing","isScreenSharingFile","isVBrowser","isYouTubeReady","isAutoPlayable","downloaded","total","speed","connections","multiStreamSelection","error","isErrorAuth","settings","vBrowserResolution","isVBrowserLarge","nonPlayableMedia","currentTab","parse","location","search","substring","tab","isSubscribeModalOpen","isVBrowserModalOpen","isScreenShareModalOpen","isFileShareModalOpen","isSubtitleModalOpen","roomLock","controller","roomId","savedPasswords","errorMessage","successMessage","isChatDisabled","showRightBar","owner","vanity","password","roomLink","roomTitle","roomDescription","roomTitleColor","mediaPath","socket","watchPartyYTPlayer","ytDebounce","screenShareStream","screenHostPC","screenSharePC","progressUpdater","heartbeat","chatRef","createRef","getRoomLink","origin","replace","handleRoomState","data","setOwner","setVanity","setPassword","setRoomLink","setIsChatDisabled","setRoomTitle","setRoomDescription","setRoomTitleColor","setMediaPath","history","replaceState","loadSettings","setState","loadSignInData","user","props","firstName","displayName","split","updateName","value","userImage","updatePicture","updateUid","loadYouTube","tag","document","createElement","src","body","append","onYouTubeIframeAPIReady","ytPlayer","YT","Player","events","onReady","isYouTube","emit","onStateChange","e","PlayerState","CUED","ENDED","onVideoEnded","PLAYING","PAUSED","doPlay","doPause","setTimeout","init","query","hash","get","response","Error","console","join","savedPasswordsString","localStorage","getItem","JSON","warn","shard","test","slice","exec","transports","clientId","on","userName","err","success","assign","doSeek","loadSubtitles","video","isScreenShare","startsWith","stopScreenShare","isFileShare","stopVBrowser","paused","subtitle","Boolean","getVBrowserHost","log","setLoadingFalse","leftVideo","getElementById","pause","stopVideo","doSrc","videoTS","addEventListener","jumpToLeader","once","clearInterval","includes","setInterval","fetch","json","disableChatSound","visibilityState","Audio","play","push","msgIndex","findIndex","m","id","msgId","timestamp","msgTimestamp","msg","reactions","length","current","isNearBottom","scrollToBottom","find","filter","syncSubtitle","updateScreenShare","process","env","NODE_ENV","from","pc","sharer","ice","addIceCandidate","RTCIceCandidate","sdp","type","_sdp","line","trim","setRemoteDescription","RTCSessionDescription","createAnswer","answer","setLocalDescription","sendSignalSS","localDescription","getCurrentTime","setupFileShare","files","file","srcObject","URL","createObjectURL","stream","captureStream","onaddtrack","getVideoTracks","getAudioTracks","onended","setupScreenShare","navigator","mediaDevices","getDisplayMedia","height","logicalSurface","audio","autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","getTracks","forEach","track","stop","close","Object","values","p","selfId","clientIds","Set","map","entries","key","has","RTCPeerConnection","addTrack","onicecandidate","event","candidate","onnegotiationneeded","createOffer","offer","ontrack","streams","startVBrowser","rcToken","options","uid","getIdToken","token","changeController","_e","to","isVideo","isHttp","getVBrowserPass","currentTime","getDuration","duration","isPauseDisabled","isMuted","muted","isSubtitled","getOption","languageCode","maxTS","getLeaderTime","time","innerHTML","url","videoId","altVideoId","cueVideoById","canAutoplay","lv","canPlayType","hls","Hls","loadSource","attachMedia","setMute","name","playVideo","pauseVideo","seekTo","togglePlay","shouldPlay","ended","getPlayerState","onSeek","target","rect","getBoundingClientRect","x","clientX","left","max","width","Math","onFullScreenChange","fullscreenElement","onKeydown","activeElement","tagName","preventDefault","toggleSubtitle","toggleMute","bVideoOnly","container","requestFullscreen","webkitEnterFullScreen","webkitEnterFullscreen","bChangeElements","exitFullscreen","mute","unMute","setVolume","volume","getVolume","subtitleSrc","arrayBuffer","buffer","Blob","kind","label","srclang","appendChild","textTracks","mode","offset","cues","i","cue","origStart","startTime","origEnd","endTime","setOption","tracks","setMedia","playlistAdd","playlistMove","index","toIndex","playlistDelete","launchMultiSelect","resetMultiSelect","setItem","getMediaDisplayName","input","magnetUrl","torrent","magnetParsed","dn","getFileName","setRoomLock","locked","haveLock","val","clearChat","fileIndex","searchParams","set","toString","onfullscreenchange","onkeydown","removeEventListener","prevProps","controls","subscribeButton","isSubscriber","isCustomer","displayRightContent","rightBar","display","flexDirection","visibility","marginTop","marginBottom","justifyContent","beta","position","bottom","right","zIndex","streamPath","gap","text","disabled","flexGrow","alignItems","maxHeight","min","toFixed","top","Component","Separator","flexShrink"],"mappings":"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","sourcesContent":["import './App.css';\n\nimport querystring from 'querystring';\nimport axios from 'axios';\nimport React from 'react';\nimport {\n  Button,\n  Dimmer,\n  Dropdown,\n  DropdownProps,\n  Grid,\n  Icon,\n  Input,\n  Loader,\n  Message,\n  Popup,\n  Progress,\n  Menu,\n  Modal,\n  Label,\n  SemanticCOLORS,\n} from 'semantic-ui-react';\nimport io, { Socket } from 'socket.io-client';\nimport { default as toWebVTT } from 'srt-webvtt';\nimport {\n  formatSpeed,\n  getMediaType,\n  iceServers,\n  isMobile,\n  serverPath,\n  testAutoplay,\n  openFileSelector,\n  getAndSaveClientId,\n  calculateMedian,\n  getUserImage,\n  getColorForString,\n} from '../../utils';\nimport { generateName } from '../../utils/generateName';\nimport { Chat } from '../Chat';\nimport { TopBar } from '../TopBar';\nimport { VBrowser } from '../VBrowser';\nimport { VideoChat } from '../VideoChat';\nimport { getCurrentSettings } from '../Settings';\nimport { MultiStreamModal } from '../Modal/MultiStreamModal';\nimport { ComboBox } from '../ComboBox/ComboBox';\nimport { SearchComponent } from '../SearchComponent/SearchComponent';\nimport { Controls } from '../Controls/Controls';\nimport { VBrowserModal } from '../Modal/VBrowserModal';\nimport { SettingsTab } from '../Settings/SettingsTab';\nimport { ErrorModal } from '../Modal/ErrorModal';\nimport { PasswordModal } from '../Modal/PasswordModal';\nimport { SubscribeButton } from '../SubscribeButton/SubscribeButton';\nimport { ScreenShareModal } from '../Modal/ScreenShareModal';\nimport { FileShareModal } from '../Modal/FileShareModal';\nimport firebase from 'firebase/compat/app';\nimport { SubtitleModal } from '../Modal/SubtitleModal';\n\ndeclare global {\n  interface Window {\n    onYouTubeIframeAPIReady: any;\n    YT: any;\n    FB: any;\n    fbAsyncInit: Function;\n    Hls: any;\n    watchparty: {\n      ourStream: MediaStream | undefined;\n      videoRefs: HTMLVideoElementDict;\n      videoPCs: PCDict;\n    };\n  }\n}\n\nwindow.watchparty = {\n  ourStream: undefined,\n  videoRefs: {},\n  videoPCs: {},\n};\n\ninterface AppProps {\n  vanity?: string;\n  user?: firebase.User;\n  isSubscriber: boolean;\n  isCustomer: boolean;\n  beta: boolean;\n  streamPath: string | undefined;\n}\n\ninterface AppState {\n  state: 'init' | 'starting' | 'connected';\n  currentMedia: string;\n  currentSubtitle: string;\n  currentMediaPaused: boolean;\n  participants: User[];\n  rosterUpdateTS: Number;\n  chat: ChatMessage[];\n  playlist: PlaylistVideo[];\n  tsMap: NumberDict;\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  myName: string;\n  myPicture: string;\n  loading: boolean;\n  scrollTimestamp: number;\n  unreadCount: number;\n  fullScreen: boolean;\n  controlsTimestamp: number;\n  watchOptions: SearchResult[];\n  isScreenSharing: boolean;\n  isScreenSharingFile: boolean;\n  isVBrowser: boolean;\n  isYouTubeReady: boolean;\n  isAutoPlayable: boolean;\n  downloaded: number;\n  total: number;\n  speed: number;\n  connections: number;\n  multiStreamSelection?: any[];\n  error: string;\n  isErrorAuth: boolean;\n  settings: Settings;\n  vBrowserResolution: string;\n  isVBrowserLarge: boolean;\n  nonPlayableMedia: boolean;\n  currentTab: string;\n  isSubscribeModalOpen: boolean;\n  isVBrowserModalOpen: boolean;\n  isScreenShareModalOpen: boolean;\n  isFileShareModalOpen: boolean;\n  isSubtitleModalOpen: boolean;\n  roomLock: string;\n  controller?: string;\n  savedPasswords: StringDict;\n  roomId: string;\n  errorMessage: string;\n  successMessage: string;\n  isChatDisabled: boolean;\n  showRightBar: boolean;\n  owner: string | undefined;\n  vanity: string | undefined;\n  password: string | undefined;\n  roomLink: string;\n  roomTitle: string | undefined;\n  roomDescription: string | undefined;\n  roomTitleColor: string | undefined;\n  mediaPath: string | undefined;\n}\n\nexport default class App extends React.Component<AppProps, AppState> {\n  state: AppState = {\n    state: 'starting',\n    currentMedia: '',\n    currentMediaPaused: false,\n    currentSubtitle: '',\n    participants: [],\n    rosterUpdateTS: Number(new Date()),\n    chat: [],\n    playlist: [],\n    tsMap: {},\n    nameMap: {},\n    pictureMap: {},\n    myName: '',\n    myPicture: '',\n    loading: true,\n    scrollTimestamp: 0,\n    unreadCount: 0,\n    fullScreen: false,\n    controlsTimestamp: 0,\n    watchOptions: [],\n    isScreenSharing: false,\n    isScreenSharingFile: false,\n    isVBrowser: false,\n    isYouTubeReady: false,\n    isAutoPlayable: true,\n    downloaded: 0,\n    total: 0,\n    speed: 0,\n    connections: 0,\n    multiStreamSelection: undefined,\n    error: '',\n    isErrorAuth: false,\n    settings: {},\n    vBrowserResolution: '1280x720@30',\n    isVBrowserLarge: false,\n    nonPlayableMedia: false,\n    currentTab:\n      (querystring.parse(window.location.search.substring(1)).tab as string) ||\n      'chat',\n    isSubscribeModalOpen: false,\n    isVBrowserModalOpen: false,\n    isScreenShareModalOpen: false,\n    isFileShareModalOpen: false,\n    isSubtitleModalOpen: false,\n    roomLock: '',\n    controller: '',\n    roomId: '',\n    savedPasswords: {},\n    errorMessage: '',\n    successMessage: '',\n    isChatDisabled: false,\n    showRightBar: true,\n    owner: undefined,\n    vanity: undefined,\n    password: undefined,\n    roomLink: '',\n    roomTitle: '',\n    roomDescription: '',\n    roomTitleColor: '',\n    mediaPath: undefined,\n  };\n  socket: Socket = null as any;\n  watchPartyYTPlayer: any = null;\n  ytDebounce = true;\n  screenShareStream?: MediaStream;\n  screenHostPC: PCDict = {};\n  screenSharePC?: RTCPeerConnection;\n  progressUpdater?: number;\n  heartbeat: number | undefined = undefined;\n\n  chatRef = React.createRef<Chat>();\n\n  async componentDidMount() {\n    document.onfullscreenchange = this.onFullScreenChange;\n    document.onkeydown = this.onKeydown;\n\n    // Send heartbeat to the server\n    this.heartbeat = window.setInterval(() => {\n      window.fetch(serverPath + '/ping');\n    }, 10 * 60 * 1000);\n\n    const canAutoplay = await testAutoplay();\n    this.setState({ isAutoPlayable: canAutoplay });\n    this.loadSettings();\n    this.loadYouTube();\n    this.init();\n  }\n\n  getRoomLink = (vanity: string) => {\n    if (vanity) {\n      return `${window.location.origin}/r/${vanity}`;\n    }\n    return `${window.location.origin}${this.state.roomId.replace('/', '#')}`;\n  };\n\n  handleRoomState = (data: any) => {\n    this.setOwner(data.owner);\n    this.setVanity(data.vanity);\n    this.setPassword(data.password);\n    this.setRoomLink(this.getRoomLink(data.vanity));\n    this.setIsChatDisabled(data.isChatDisabled);\n    this.setRoomTitle(data.roomTitle);\n    this.setRoomDescription(data.roomDescription);\n    this.setRoomTitleColor(data.roomTitleColor);\n    this.setMediaPath(data.mediaPath);\n    window.history.replaceState('', '', this.getRoomLink(data.vanity));\n  };\n\n  componentWillUnmount() {\n    document.removeEventListener('fullscreenchange', this.onFullScreenChange);\n    document.removeEventListener('keydown', this.onKeydown);\n    window.clearInterval(this.heartbeat);\n  }\n\n  componentDidUpdate(prevProps: AppProps) {\n    if (this.props.user && !prevProps.user) {\n      this.loadSignInData();\n    }\n  }\n\n  loadSettings = async () => {\n    // Load settings from localstorage\n    let settings = getCurrentSettings();\n    this.setState({ settings });\n  };\n\n  loadSignInData = async () => {\n    const user = this.props.user;\n    if (user && this.socket) {\n      // NOTE: firebase auth doesn't provide the actual first name data that individual providers (G/FB) do\n      // It's accessible at the time the user logs in but not afterward\n      // If we want accurate surname/given name we'll need to save that somewhere\n      const firstName = user.displayName?.split(' ')[0];\n      if (firstName) {\n        this.updateName(null, { value: firstName });\n      }\n      const userImage = await getUserImage(user);\n      if (userImage) {\n        this.updatePicture(userImage);\n      }\n      this.updateUid(user);\n    }\n  };\n\n  loadYouTube = () => {\n    // This code loads the IFrame Player API code asynchronously.\n    const tag = document.createElement('script');\n    tag.src = 'https://www.youtube.com/iframe_api';\n    document.body.append(tag);\n    window.onYouTubeIframeAPIReady = () => {\n      // Note: this fails silently if the element is not available\n      const ytPlayer = new window.YT.Player('leftYt', {\n        events: {\n          onReady: () => {\n            this.watchPartyYTPlayer = ytPlayer;\n            this.setState({ isYouTubeReady: true, loading: false });\n            // We might have failed to play YT originally, ask for the current video again\n            if (this.isYouTube()) {\n              this.socket.emit('CMD:askHost');\n            }\n          },\n          onStateChange: (e: any) => {\n            if (\n              getMediaType(this.state.currentMedia) === 'youtube' &&\n              e.data === window.YT?.PlayerState?.CUED\n            ) {\n              this.setState({ loading: false });\n            }\n            if (\n              getMediaType(this.state.currentMedia) === 'youtube' &&\n              e.data === window.YT?.PlayerState?.ENDED\n            ) {\n              this.onVideoEnded();\n            }\n            // console.log(this.ytDebounce, e.data, this.watchPartyYTPlayer?.getVideoUrl());\n            if (\n              this.ytDebounce &&\n              ((e.data === window.YT?.PlayerState?.PLAYING &&\n                this.state.currentMediaPaused) ||\n                (e.data === window.YT?.PlayerState?.PAUSED &&\n                  !this.state.currentMediaPaused))\n            ) {\n              this.ytDebounce = false;\n              if (e.data === window.YT?.PlayerState?.PLAYING) {\n                this.socket.emit('CMD:play');\n                this.doPlay();\n              } else {\n                this.socket.emit('CMD:pause');\n                this.doPause();\n              }\n              window.setTimeout(() => (this.ytDebounce = true), 500);\n            }\n          },\n        },\n      });\n    };\n  };\n\n  setOwner = (owner: string) => {\n    this.setState({ owner });\n  };\n  setVanity = (vanity: string | undefined) => {\n    this.setState({ vanity });\n  };\n  setPassword = (password: string | undefined) => {\n    this.setState({ password });\n  };\n  setRoomLink = (roomLink: string) => {\n    this.setState({ roomLink });\n  };\n  setRoomTitle = (roomTitle: string | undefined) => {\n    this.setState({ roomTitle });\n  };\n  setRoomDescription = (roomDescription: string | undefined) => {\n    this.setState({ roomDescription });\n  };\n  setRoomTitleColor = (roomTitleColor: string | undefined) => {\n    this.setState({ roomTitleColor });\n  };\n  setMediaPath = (mediaPath: string | undefined) => {\n    this.setState({ mediaPath });\n  };\n\n  init = async () => {\n    // Load room ID from url\n    let roomId = '/default';\n    let query = window.location.hash.substring(1);\n    if (query) {\n      roomId = '/' + query;\n    }\n    // if a vanity name, resolve the url to a room id\n    if (this.props.vanity) {\n      try {\n        const response = await axios.get(\n          serverPath + '/resolveRoom/' + this.props.vanity\n        );\n        if (response.data.roomId) {\n          roomId = response.data.roomId;\n        } else {\n          throw new Error('failed to resolve room name');\n        }\n      } catch (e) {\n        console.error(e);\n        this.setState({ error: \"There's no room with this name.\" });\n        return;\n      }\n    }\n    this.setState({ roomId }, () => {\n      this.join(roomId);\n    });\n  };\n\n  join = async (roomId: string) => {\n    let password = '';\n    try {\n      const savedPasswordsString = window.localStorage.getItem(\n        'watchparty-passwords'\n      );\n      const savedPasswords = JSON.parse(savedPasswordsString || '{}');\n      this.setState({ savedPasswords });\n      password = savedPasswords[roomId] || '';\n    } catch (e) {\n      console.warn('[ALERT] Could not parse saved passwords');\n    }\n    let shard = '';\n    if (/^\\d/.test(roomId.slice(1))) {\n      // Rooms assigned to shards start with a number\n      shard = /^\\d+/.exec(roomId.slice(1))?.[0] ?? '';\n    }\n    const socket = io(serverPath + roomId, {\n      transports: ['websocket'],\n      query: {\n        clientId: getAndSaveClientId(),\n        password,\n        shard,\n      },\n    });\n    this.socket = socket;\n    socket.on('connect', async () => {\n      this.setState({ state: 'connected' });\n      // Load username from localstorage\n      let userName = window.localStorage.getItem('watchparty-username');\n      this.updateName(null, { value: userName || generateName() });\n      this.loadSignInData();\n    });\n    socket.on('error', (err: any) => {\n      console.error(err);\n      if (err === 'Invalid namespace') {\n        this.setState({ error: \"There's no room with this name.\" });\n      } else if (err === 'not authorized') {\n        this.setState({ isErrorAuth: true });\n      } else if (err === 'room full') {\n        this.setState({ error: 'This room is full.' });\n      } else {\n        this.setState({ error: 'An error occurred.' });\n      }\n    });\n    socket.on('errorMessage', (err: string) => {\n      this.setState({ errorMessage: err });\n      setTimeout(() => {\n        this.setState({ errorMessage: '' });\n      }, 3000);\n    });\n    socket.on('successMessage', (success: string) => {\n      this.setState({ successMessage: success });\n      setTimeout(() => {\n        this.setState({ successMessage: '' });\n      }, 3000);\n    });\n    socket.on('kicked', () => {\n      window.location.assign('/');\n    });\n    socket.on('REC:play', () => {\n      this.doPlay();\n    });\n    socket.on('REC:pause', () => {\n      this.doPause();\n    });\n    socket.on('REC:seek', (data: any) => {\n      this.doSeek(data);\n    });\n    socket.on('REC:subtitle', (data: string) => {\n      this.setState({ currentSubtitle: data }, () => {\n        this.loadSubtitles();\n      });\n    });\n    socket.on('REC:changeController', (data: string) => {\n      this.setState({ controller: data });\n    });\n    socket.on('REC:host', async (data: HostState) => {\n      let currentMedia = data.video || '';\n      if (this.isScreenShare() && !currentMedia.startsWith('screenshare://')) {\n        this.stopScreenShare();\n      }\n      if (this.isFileShare() && !currentMedia.startsWith('fileshare://')) {\n        this.stopScreenShare();\n      }\n      if (this.isScreenShare() && currentMedia.startsWith('screenshare://')) {\n        // Ignore, it's probably a reconnection\n        return;\n      }\n      if (this.isFileShare() && currentMedia.startsWith('fileshare://')) {\n        // Ignore, it's probably a reconnection\n        return;\n      }\n      if (this.isVBrowser() && !currentMedia.startsWith('vbrowser://')) {\n        this.stopVBrowser();\n      }\n      this.setState(\n        {\n          currentMedia,\n          currentMediaPaused: data.paused,\n          currentSubtitle: data.subtitle,\n          loading: Boolean(data.video),\n          nonPlayableMedia: false,\n          isVBrowserLarge: data.isVBrowserLarge,\n          vBrowserResolution: data.isVBrowserLarge\n            ? '1920x1080@30'\n            : '1280x720@30',\n          controller: data.controller,\n        },\n        () => {\n          if (\n            this.state.isScreenSharingFile ||\n            (this.isVBrowser() && this.getVBrowserHost())\n          ) {\n            console.log(\n              'skipping REC:host video since fileshare is using leftVideo or this is a vbrowser'\n            );\n            this.setLoadingFalse();\n            return;\n          }\n          // Stop all players\n          const leftVideo = document.getElementById(\n            'leftVideo'\n          ) as HTMLMediaElement;\n          leftVideo?.pause();\n          this.watchPartyYTPlayer?.stopVideo();\n\n          if (this.isYouTube() && !this.watchPartyYTPlayer) {\n            console.log(\n              'YT player not ready, onReady callback will retry when it is'\n            );\n          } else if (this.isVBrowser()) {\n            console.log(\n              'not playing video as this is a vbrowser:// placeholder'\n            );\n          } else {\n            // Start this video\n            this.doSrc(data.video, data.videoTS);\n            if (!data.paused) {\n              this.doPlay();\n            }\n            if (data.subtitle) {\n              this.loadSubtitles();\n            }\n            // else if (this.isHttp() && !this.isYouTube()) {\n            //   const src = data.video;\n            //   const subtitlePath = src.slice(0, src.lastIndexOf('/') + 1);\n            //   // Expect subtitle name to be file name + .srt\n            //   const subtitleSrc = subtitlePath + 'subtitles/' + this.getFileName(src) + '.srt';\n            //   this.setState({ currentSubtitle: subtitleSrc }, () => {\n            //     this.loadSubtitles();\n            //   });\n            // }\n            // One time, when we're ready to play\n            leftVideo?.addEventListener(\n              'canplay',\n              () => {\n                this.setLoadingFalse();\n                this.jumpToLeader();\n              },\n              { once: true }\n            );\n\n            // Progress updater\n            window.clearInterval(this.progressUpdater);\n            this.setState({ downloaded: 0, total: 0, speed: 0 });\n            if (currentMedia.includes('/stream?torrent=magnet')) {\n              this.progressUpdater = window.setInterval(async () => {\n                const response = await window.fetch(\n                  currentMedia.replace('/stream', '/progress')\n                );\n                const data = await response.json();\n                this.setState({\n                  downloaded: data.downloaded,\n                  total: data.total,\n                  speed: data.speed,\n                  connections: data.connections,\n                });\n              }, 1000);\n            }\n          }\n        }\n      );\n    });\n    socket.on('REC:chat', (data: ChatMessage) => {\n      if (\n        !getCurrentSettings().disableChatSound &&\n        ((document.visibilityState && document.visibilityState !== 'visible') ||\n          this.state.currentTab !== 'chat')\n      ) {\n        new Audio('/clearly.mp3').play();\n      }\n      this.state.chat.push(data);\n      this.setState({\n        chat: this.state.chat,\n        scrollTimestamp: Number(new Date()),\n        unreadCount:\n          this.state.currentTab === 'chat'\n            ? this.state.unreadCount\n            : this.state.unreadCount + 1,\n      });\n    });\n    socket.on('REC:addReaction', (data: Reaction) => {\n      const { chat } = this.state;\n      const msgIndex = chat.findIndex(\n        (m) => m.id === data.msgId && m.timestamp === data.msgTimestamp\n      );\n      if (msgIndex === -1) {\n        return;\n      }\n      const msg = chat[msgIndex];\n      msg.reactions = msg.reactions || {};\n      msg.reactions[data.value] = msg.reactions[data.value] || [];\n      msg.reactions[data.value].push(data.user);\n      this.setState({ chat }, () => {\n        // if we add a reaction to the last message we need to scroll down\n        // or else the reaction icon might be hidden\n        if (\n          msgIndex === chat.length - 1 &&\n          this.chatRef.current?.state.isNearBottom\n        ) {\n          this.chatRef.current?.scrollToBottom();\n        }\n      });\n    });\n    socket.on('REC:removeReaction', (data: Reaction) => {\n      const { chat } = this.state;\n      const msg = chat.find(\n        (m) => m.id === data.msgId && m.timestamp === data.msgTimestamp\n      );\n      if (!msg || !msg.reactions?.[data.value]) {\n        return;\n      }\n      msg.reactions[data.value] = msg.reactions[data.value].filter(\n        (id) => id !== data.user\n      );\n      this.setState({ chat });\n    });\n    socket.on('REC:tsMap', (data: NumberDict) => {\n      this.setState({ tsMap: data });\n      this.syncSubtitle();\n    });\n    socket.on('REC:nameMap', (data: StringDict) => {\n      this.setState({ nameMap: data });\n    });\n    socket.on('REC:pictureMap', (data: StringDict) => {\n      this.setState({ pictureMap: data });\n    });\n    socket.on('REC:lock', (data: string) => {\n      this.setState({ roomLock: data });\n    });\n    socket.on('roster', (data: User[]) => {\n      this.setState(\n        { participants: data, rosterUpdateTS: Number(new Date()) },\n        () => {\n          this.updateScreenShare();\n        }\n      );\n    });\n    socket.on('chatinit', (data: ChatMessage[]) => {\n      this.setState({ chat: data, scrollTimestamp: Number(new Date()) });\n    });\n    socket.on('playlist', (data: PlaylistVideo[]) => {\n      this.setState({ playlist: data });\n    });\n    socket.on('signalSS', async (data: any) => {\n      process.env.NODE_ENV === 'development' && console.log(data);\n      // Handle messages received from signaling server\n      const msg = data.msg;\n      const from = data.from;\n      // Determine whether the message came from the sharer or the sharee\n      const pc = (\n        data.sharer ? this.screenSharePC : this.screenHostPC[from]\n      ) as RTCPeerConnection;\n      if (msg.ice !== undefined) {\n        pc.addIceCandidate(new RTCIceCandidate(msg.ice));\n      } else if (msg.sdp && msg.sdp.type === 'offer') {\n        // console.log('offer');\n        // TODO Currently ios/Safari cannot handle this property, so remove it from the offer\n        const _sdp = msg.sdp.sdp\n          .split('\\n')\n          .filter((line: string) => {\n            return line.trim() !== 'a=extmap-allow-mixed';\n          })\n          .join('\\n');\n        msg.sdp.sdp = _sdp;\n        await pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n        const answer = await pc.createAnswer();\n        answer.sdp = answer.sdp?.replace(\n          'useinbandfec=1',\n          'useinbandfec=1; stereo=1; maxaveragebitrate=510000'\n        );\n        await pc.setLocalDescription(answer);\n        this.sendSignalSS(from, { sdp: pc.localDescription }, !data.sharer);\n      } else if (msg.sdp && msg.sdp.type === 'answer') {\n        pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));\n      }\n    });\n    socket.on('REC:getRoomState', this.handleRoomState);\n    window.setInterval(() => {\n      if (this.state.currentMedia) {\n        this.socket.emit('CMD:ts', this.getCurrentTime());\n      }\n    }, 1000);\n  };\n\n  setupFileShare = async () => {\n    const files = await openFileSelector();\n    if (!files) {\n      return;\n    }\n    const file = files[0];\n    const leftVideo = document.getElementById('leftVideo') as HTMLMediaElement;\n    leftVideo.srcObject = null;\n    leftVideo.src = URL.createObjectURL(file);\n    leftVideo.play();\n    //@ts-ignore\n    const stream = leftVideo.captureStream ? leftVideo.captureStream() : {};\n    // Can render video to a canvas to resize it, reduce size\n    stream.onaddtrack = () => {\n      console.log(stream, stream.getVideoTracks(), stream.getAudioTracks());\n      if (\n        !this.screenShareStream &&\n        stream.getVideoTracks().length &&\n        stream.getAudioTracks().length\n      ) {\n        stream.getVideoTracks()[0].onended = this.stopScreenShare;\n        this.screenShareStream = stream;\n        this.socket.emit('CMD:joinScreenShare', { file: true });\n        this.setState({ isScreenSharing: true, isScreenSharingFile: true });\n        stream.onaddtrack = undefined;\n      }\n    };\n  };\n\n  setupScreenShare = async () => {\n    if (navigator.mediaDevices.getDisplayMedia) {\n      const stream = await navigator.mediaDevices.getDisplayMedia({\n        //@ts-ignore\n        video: { height: 720, logicalSurface: true },\n        audio: {\n          autoGainControl: false,\n          channelCount: 2,\n          echoCancellation: false,\n          latency: 0,\n          noiseSuppression: false,\n          sampleRate: 48000,\n          sampleSize: 16,\n        },\n      });\n      stream.getVideoTracks()[0].onended = this.stopScreenShare;\n      this.screenShareStream = stream;\n      this.socket.emit('CMD:joinScreenShare');\n      this.setState({ isScreenSharing: true });\n    }\n  };\n\n  stopScreenShare = async () => {\n    this.screenShareStream &&\n      this.screenShareStream.getTracks().forEach((track) => {\n        track.stop();\n      });\n    this.screenShareStream = undefined;\n    if (this.screenSharePC) {\n      this.screenSharePC.close();\n      this.screenSharePC = undefined;\n    }\n    Object.values(this.screenHostPC).forEach((pc) => {\n      pc.close();\n    });\n    this.screenHostPC = {};\n    if (this.state.isScreenSharing) {\n      this.socket.emit('CMD:leaveScreenShare');\n    }\n    this.setState({ isScreenSharing: false, isScreenSharingFile: false });\n  };\n\n  updateScreenShare = async () => {\n    if (!this.isScreenShare() && !this.isFileShare()) {\n      return;\n    }\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    const selfId = getAndSaveClientId();\n    if (sharer && sharer.clientId === selfId) {\n      // We're the sharer, create a connection to each other member\n\n      // Delete and close any connections that aren't in the current member list (maybe someone disconnected)\n      // This allows them to rejoin later\n      const clientIds = new Set(this.state.participants.map((p) => p.clientId));\n      Object.entries(this.screenHostPC).forEach(([key, value]) => {\n        if (!clientIds.has(key)) {\n          value.close();\n          delete this.screenHostPC[key];\n        }\n      });\n\n      this.state.participants.forEach((user) => {\n        const id = user.clientId;\n        if (id === selfId && this.state.isScreenSharingFile) {\n          // Don't set up a connection to ourselves if sharing file\n          return;\n        }\n        if (!this.screenHostPC[id]) {\n          // Set up the RTCPeerConnection for sharing media to each member\n          const pc = new RTCPeerConnection({ iceServers: iceServers() });\n          this.screenHostPC[id] = pc;\n          this.screenShareStream?.getTracks().forEach((track) => {\n            if (this.screenShareStream != null) {\n              pc.addTrack(track, this.screenShareStream);\n            }\n          });\n          pc.onicecandidate = (event) => {\n            // We generated an ICE candidate, send it to peer\n            if (event.candidate) {\n              this.sendSignalSS(id, { ice: event.candidate }, true);\n            }\n          };\n          pc.onnegotiationneeded = async () => {\n            // Start connection for peer's video\n            const offer = await pc.createOffer();\n            await pc.setLocalDescription(offer);\n            this.sendSignalSS(id, { sdp: pc.localDescription }, true);\n          };\n        }\n      });\n    }\n    // We're a watcher, establish connection to sharer\n    // If screensharing, sharer also does this\n    // If filesharing, sharer does not do this since we use leftVideo\n    if (sharer && !this.screenSharePC && !this.state.isScreenSharingFile) {\n      const pc = new RTCPeerConnection({ iceServers: iceServers() });\n      this.screenSharePC = pc;\n      pc.onicecandidate = (event) => {\n        // We generated an ICE candidate, send it to peer\n        if (event.candidate) {\n          this.sendSignalSS(sharer.clientId, { ice: event.candidate });\n        }\n      };\n      pc.ontrack = (event: RTCTrackEvent) => {\n        // Mount the stream from peer\n        // console.log(stream);\n        const leftVideo = document.getElementById(\n          'leftVideo'\n        ) as HTMLMediaElement;\n        if (leftVideo) {\n          leftVideo.src = '';\n          leftVideo.srcObject = event.streams[0];\n          this.doPlay();\n        }\n      };\n    }\n  };\n\n  startVBrowser = async (rcToken: string, options: { size: string }) => {\n    // user.uid is the public user identifier\n    // user.getIdToken() is the secret access token we can send to the server to prove identity\n    const user = this.props.user;\n    const uid = user?.uid;\n    const token = await user?.getIdToken();\n    this.socket.emit('CMD:startVBrowser', { options, uid, token, rcToken });\n  };\n\n  stopVBrowser = async () => {\n    this.socket.emit('CMD:stopVBrowser');\n  };\n\n  changeController = async (_e: any, data: DropdownProps) => {\n    // console.log(data);\n    this.socket.emit('CMD:changeController', data.value);\n  };\n\n  sendSignalSS = async (to: string, data: any, sharer?: boolean) => {\n    // console.log('sendSS', to, data);\n    this.socket.emit('signalSS', { to, msg: data, sharer });\n  };\n\n  isYouTube = () => {\n    return getMediaType(this.state.currentMedia) === 'youtube';\n  };\n\n  isVideo = () => {\n    return getMediaType(this.state.currentMedia) === 'video';\n  };\n\n  isScreenShare = () => {\n    return this.state.currentMedia.startsWith('screenshare://');\n  };\n\n  isFileShare = () => {\n    return this.state.currentMedia.startsWith('fileshare://');\n  };\n\n  isVBrowser = () => {\n    return this.state.currentMedia.startsWith('vbrowser://');\n  };\n\n  isHttp = () => {\n    return this.state.currentMedia.startsWith('http');\n  };\n\n  getVBrowserPass = () => {\n    return this.state.currentMedia.replace('vbrowser://', '').split('@')[0];\n  };\n\n  getVBrowserHost = () => {\n    return this.state.currentMedia.replace('vbrowser://', '').split('@')[1];\n  };\n\n  getCurrentTime = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo?.currentTime;\n    }\n    if (this.isYouTube()) {\n      return this.watchPartyYTPlayer?.getCurrentTime();\n    }\n  };\n\n  getDuration = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo.duration;\n    }\n    if (this.isYouTube()) {\n      return this.watchPartyYTPlayer?.getDuration();\n    }\n    return 0;\n  };\n\n  isPauseDisabled = () => {\n    return this.isScreenShare() || this.isVBrowser();\n  };\n\n  isMuted = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo?.muted;\n    }\n    if (this.isYouTube()) {\n      return this.watchPartyYTPlayer?.isMuted();\n    }\n    return false;\n  };\n\n  isSubtitled = () => {\n    if (this.isVideo()) {\n      return Boolean(this.state.currentSubtitle);\n    }\n    if (this.isYouTube()) {\n      try {\n        const current = this.watchPartyYTPlayer?.getOption('captions', 'track');\n        return Boolean(current && current.languageCode);\n      } catch (e) {\n        console.warn(e);\n        return false;\n      }\n    }\n    return false;\n  };\n\n  jumpToLeader = () => {\n    // Jump to the leader's position\n    const maxTS = this.getLeaderTime();\n    if (maxTS > 0) {\n      console.log('jump to leader at ', maxTS);\n      this.doSeek(maxTS);\n    }\n  };\n\n  doSrc = async (src: string, time: number) => {\n    console.log('doSrc', src, time);\n    if (this.isScreenShare() || this.isFileShare() || this.isVBrowser()) {\n      // No-op as we'll set video when WebRTC completes\n      return;\n    }\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      if (leftVideo) {\n        leftVideo.srcObject = null;\n        leftVideo.src = src;\n        leftVideo.currentTime = time;\n        // Clear subtitles\n        leftVideo.innerHTML = '';\n      }\n    }\n    if (this.isYouTube()) {\n      let url = new window.URL(src);\n      // Standard link https://www.youtube.com/watch?v=ID\n      let videoId = querystring.parse(url.search.substring(1))['v'];\n      // Link shortener https://youtu.be/ID\n      let altVideoId = src.split('/').slice(-1)[0];\n      this.watchPartyYTPlayer?.cueVideoById(videoId || altVideoId, time);\n    }\n  };\n\n  doPlay = async () => {\n    const canAutoplay = this.state.isAutoPlayable || (await testAutoplay());\n    this.setState(\n      { currentMediaPaused: false, isAutoPlayable: canAutoplay },\n      async () => {\n        if (this.isVideo()) {\n          const leftVideo = document.getElementById(\n            'leftVideo'\n          ) as HTMLMediaElement;\n          //check for HLS\n          let lv = leftVideo?.src.split('.');\n          if (\n            lv[lv.length - 1] === 'm3u8' &&\n            !leftVideo?.canPlayType('application/vnd.apple.mpegurl')\n          ) {\n            let hls = new window.Hls();\n            hls.loadSource(leftVideo.src);\n            hls.attachMedia(leftVideo);\n          }\n          try {\n            if (this.state.isAutoPlayable) {\n              this.setMute(false);\n            } else {\n              this.setMute(true);\n            }\n            await leftVideo?.play();\n          } catch (e: any) {\n            console.warn(e);\n            if (e.name === 'NotSupportedError') {\n              this.setState({ loading: false, nonPlayableMedia: true });\n            }\n          }\n        }\n        if (this.isYouTube()) {\n          setTimeout(() => {\n            console.log('play yt');\n            this.watchPartyYTPlayer?.playVideo();\n          }, 200);\n        }\n      }\n    );\n  };\n\n  doPause = () => {\n    this.setState({ currentMediaPaused: true }, async () => {\n      if (this.isVideo()) {\n        const leftVideo = document.getElementById(\n          'leftVideo'\n        ) as HTMLMediaElement;\n        leftVideo.pause();\n      }\n      if (this.isYouTube()) {\n        console.log('pause');\n        this.watchPartyYTPlayer?.pauseVideo();\n      }\n    });\n  };\n\n  doSeek = (time: number) => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      leftVideo.currentTime = time;\n    }\n    if (this.isYouTube()) {\n      this.watchPartyYTPlayer?.seekTo(time, true);\n    }\n  };\n\n  togglePlay = () => {\n    if (this.isPauseDisabled()) {\n      return;\n    }\n    let shouldPlay = true;\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      shouldPlay = leftVideo.paused || leftVideo.ended;\n    } else if (this.isYouTube()) {\n      shouldPlay =\n        this.watchPartyYTPlayer?.getPlayerState() ===\n          window.YT?.PlayerState.PAUSED ||\n        this.getCurrentTime() === this.getDuration();\n    }\n    if (shouldPlay) {\n      this.socket.emit('CMD:play');\n      this.doPlay();\n    } else {\n      this.socket.emit('CMD:pause');\n      this.doPause();\n    }\n  };\n\n  onSeek = (e: any, time: number) => {\n    let target = time;\n    if (e) {\n      const rect = e.target.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const max = rect.width;\n      target = (x / max) * this.getDuration();\n    }\n    target = Math.max(target, 0);\n    this.doSeek(target);\n    this.socket.emit('CMD:seek', target);\n  };\n\n  onFullScreenChange = () => {\n    this.setState({ fullScreen: Boolean(document.fullscreenElement) });\n  };\n\n  onKeydown = (e: any) => {\n    if (!document.activeElement || document.activeElement.tagName === 'BODY') {\n      if (e.key === ' ') {\n        e.preventDefault();\n        this.togglePlay();\n      } else if (e.key === 'ArrowRight') {\n        this.onSeek(null, this.getCurrentTime() + 10);\n      } else if (e.key === 'ArrowLeft') {\n        this.onSeek(null, this.getCurrentTime() - 10);\n      } else if (e.key === 'c') {\n        this.toggleSubtitle();\n      } else if (e.key === 't') {\n        this.fullScreen(false);\n      } else if (e.key === 'f') {\n        this.fullScreen(true);\n      } else if (e.key === 'm') {\n        this.toggleMute();\n      }\n    }\n  };\n\n  fullScreen = async (bVideoOnly: boolean) => {\n    let container = document.getElementById('theaterContainer') as HTMLElement;\n    if (bVideoOnly || isMobile()) {\n      if (this.isVBrowser() && !isMobile()) {\n        // Can't really control the VBrowser on mobile anyway, so just fullscreen the video\n        // https://github.com/howardchung/watchparty/issues/208\n        container = document.getElementById('leftVideoParent') as HTMLElement;\n      } else {\n        container = document.getElementById(\n          this.isYouTube() ? 'leftYt' : 'leftVideo'\n        ) as HTMLElement;\n      }\n    }\n    if (\n      !container.requestFullscreen &&\n      (container as any).webkitEnterFullScreen\n    ) {\n      // e.g. iPhone doesn't allow requestFullscreen\n      (container as any).webkitEnterFullscreen();\n      return;\n    }\n    if (!document.fullscreenElement) {\n      await container.requestFullscreen();\n      return;\n    }\n    const bChangeElements = document.fullscreenElement !== container;\n    await document.exitFullscreen();\n    if (bChangeElements) {\n      await container.requestFullscreen();\n    }\n  };\n\n  toggleMute = () => {\n    this.setMute(!this.isMuted());\n  };\n\n  setMute = (muted: boolean) => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      if (leftVideo) {\n        leftVideo.muted = muted;\n      }\n      const audio = document.getElementById('iPhoneAudio') as HTMLAudioElement;\n      if (audio) {\n        audio.muted = muted;\n      }\n    }\n    if (this.isYouTube()) {\n      if (muted) {\n        this.watchPartyYTPlayer?.mute();\n      } else {\n        this.watchPartyYTPlayer?.unMute();\n      }\n    }\n  };\n\n  setVolume = (volume: number) => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      leftVideo.volume = volume;\n    }\n    if (this.isYouTube()) {\n      this.watchPartyYTPlayer?.setVolume(volume * 100);\n    }\n  };\n\n  getVolume = () => {\n    if (this.isVideo()) {\n      const leftVideo = document.getElementById(\n        'leftVideo'\n      ) as HTMLMediaElement;\n      return leftVideo.volume;\n    }\n    if (this.isYouTube()) {\n      const volume = this.watchPartyYTPlayer?.getVolume();\n      return volume / 100;\n    }\n  };\n\n  loadSubtitles = async () => {\n    const leftVideo = document.getElementById('leftVideo') as HTMLMediaElement;\n    if (!this.isSubtitled()) {\n      leftVideo.innerHTML = '';\n    } else {\n      // Clear subtitles and put new ones in\n      leftVideo.innerHTML = '';\n      let subtitleSrc = this.state.currentSubtitle;\n      if (subtitleSrc) {\n        const response = await window.fetch(subtitleSrc);\n        const buffer = await response.arrayBuffer();\n        const url = await toWebVTT(new Blob([buffer]));\n        const track = document.createElement('track');\n        track.kind = 'captions';\n        track.label = 'English';\n        track.srclang = 'en';\n        track.src = url;\n        leftVideo.appendChild(track);\n        leftVideo.textTracks[0].mode = 'showing';\n      }\n    }\n  };\n\n  syncSubtitle = () => {\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    if (!sharer || sharer.id === this.socket.id) {\n      return;\n    }\n    // When sharing, our timestamp doesn't match the subtitles so adjust them\n    // For each cue, subtract the videoTS of the sharer, then add our own\n    const leftVideo = document.getElementById('leftVideo') as HTMLMediaElement;\n    const track = leftVideo?.textTracks[0];\n    let offset = leftVideo.currentTime - this.state.tsMap[sharer.id];\n    if (track && track.cues && offset) {\n      for (let i = 0; i < track.cues.length; i++) {\n        let cue = track?.cues?.[i];\n        if (!cue) {\n          continue;\n        }\n        // console.log(cue.text, offset, (cue as any).origStart, (cue as any).origEnd);\n        if (!(cue as any).origStart) {\n          (cue as any).origStart = cue.startTime;\n          (cue as any).origEnd = cue.endTime;\n        }\n        cue.startTime = (cue as any).origStart + offset;\n        cue.endTime = (cue as any).origEnd + offset;\n      }\n    }\n  };\n\n  toggleSubtitle = () => {\n    if (this.isVideo()) {\n      this.setState({ isSubtitleModalOpen: true });\n    }\n    if (this.isYouTube()) {\n      const isSubtitled = this.isSubtitled();\n      // console.log(isSubtitled);\n      if (isSubtitled) {\n        // BUG this doesn't actually set the value so subtitles can't be toggled off\n        this.watchPartyYTPlayer?.setOption('captions', 'track', {});\n      } else {\n        this.watchPartyYTPlayer?.setOption('captions', 'reload', true);\n        const tracks = this.watchPartyYTPlayer?.getOption(\n          'captions',\n          'tracklist'\n        );\n        this.watchPartyYTPlayer?.setOption('captions', 'track', tracks?.[0]);\n      }\n    }\n  };\n\n  setMedia = (_e: any, data: DropdownProps) => {\n    this.socket.emit('CMD:host', data.value);\n  };\n\n  playlistAdd = (_e: any, data: DropdownProps) => {\n    this.socket.emit('CMD:playlistAdd', data.value);\n  };\n\n  playlistMove = (index: number, toIndex: number) => {\n    this.socket.emit('CMD:playlistMove', { index, toIndex });\n  };\n\n  playlistDelete = (index: number) => {\n    this.socket.emit('CMD:playlistDelete', index);\n  };\n\n  launchMultiSelect = (data: any) => {\n    this.setState({ multiStreamSelection: data });\n  };\n\n  resetMultiSelect = () => {\n    this.setState({ multiStreamSelection: undefined });\n  };\n\n  updateName = (_e: any, data: { value: string }) => {\n    this.setState({ myName: data.value });\n    this.socket.emit('CMD:name', data.value);\n    window.localStorage.setItem('watchparty-username', data.value);\n  };\n\n  updatePicture = (url: string) => {\n    this.setState({ myPicture: url });\n    this.socket.emit('CMD:picture', url);\n  };\n\n  updateUid = async (user: firebase.User) => {\n    const uid = user.uid;\n    const token = await user.getIdToken();\n    this.socket.emit('CMD:uid', { uid, token });\n  };\n\n  getMediaDisplayName = (input: string) => {\n    if (!input) {\n      return '';\n    }\n    // Show the whole URL for youtube\n    if (getMediaType(input) === 'youtube') {\n      return input;\n    }\n    if (input.startsWith('screenshare://')) {\n      const sharer = this.state.participants.find((user) => user.isScreenShare);\n      return this.state.nameMap[sharer?.id ?? ''] + \"'s screen\";\n    }\n    if (input.startsWith('fileshare://')) {\n      const sharer = this.state.participants.find((user) => user.isScreenShare);\n      return this.state.nameMap[sharer?.id ?? ''] + \"'s file\";\n    }\n    if (input.startsWith('vbrowser://')) {\n      return 'Virtual Browser' + (this.state.isVBrowserLarge ? '+' : '');\n    }\n    if (input.includes('/stream?torrent=magnet')) {\n      const search = new URL(input).search;\n      const magnetUrl = querystring.parse(search.substring(1))\n        .torrent as string;\n      const magnetParsed = querystring.parse(magnetUrl);\n      return magnetParsed.dn;\n    }\n    // Get the filename out of the URL\n    return input;\n  };\n\n  getFileName = (input: string) => {\n    return input.split('/').slice(-1)[0];\n  };\n\n  setLoadingFalse = () => {\n    this.setState({ loading: false });\n  };\n\n  setRoomLock = async (locked: boolean) => {\n    const uid = this.props.user?.uid;\n    const token = await this.props.user?.getIdToken();\n    this.socket.emit('CMD:lock', { uid, token, locked });\n  };\n\n  haveLock = () => {\n    if (!this.state.roomLock) {\n      return true;\n    }\n    return this.props.user?.uid === this.state.roomLock;\n  };\n\n  setIsChatDisabled = (val: boolean) => this.setState({ isChatDisabled: val });\n\n  clearChat = async () => {\n    const uid = this.props.user?.uid;\n    const token = await this.props.user?.getIdToken();\n    this.socket.emit('CMD:deleteChatMessages', { uid, token });\n  };\n\n  getLeaderTime = () => {\n    if (this.state.participants.length > 2) {\n      return calculateMedian(Object.values(this.state.tsMap));\n    }\n    return Math.max(...Object.values(this.state.tsMap));\n  };\n\n  onVideoEnded = () => {\n    this.socket.emit('CMD:playlistNext', this.state.currentMedia);\n    // Play next\n    if (this.state.currentMedia?.includes('/stream?torrent=magnet')) {\n      const url = new URL(this.state.currentMedia);\n      const fileIndex = url.searchParams.get('fileIndex');\n      if (fileIndex != null) {\n        url.searchParams.set('fileIndex', (Number(fileIndex) + 1).toString());\n        this.setMedia(null, { value: url.toString() });\n      }\n    }\n  };\n\n  render() {\n    const sharer = this.state.participants.find((p) => p.isScreenShare);\n    const controls = (\n      <Controls\n        key={this.state.controlsTimestamp}\n        togglePlay={this.togglePlay}\n        onSeek={this.onSeek}\n        fullScreen={this.fullScreen}\n        toggleMute={this.toggleMute}\n        toggleSubtitle={this.toggleSubtitle}\n        setVolume={this.setVolume}\n        jumpToLeader={this.jumpToLeader}\n        paused={this.state.currentMediaPaused}\n        muted={this.isMuted()}\n        subtitled={this.isSubtitled()}\n        currentTime={this.getCurrentTime()}\n        duration={this.getDuration()}\n        disabled={!this.haveLock()}\n        leaderTime={this.isHttp() ? this.getLeaderTime() : undefined}\n        isPauseDisabled={this.isPauseDisabled()}\n      />\n    );\n    const subscribeButton = (\n      <SubscribeButton\n        user={this.props.user}\n        isSubscriber={this.props.isSubscriber}\n        isCustomer={this.props.isCustomer}\n      />\n    );\n    const displayRightContent =\n      this.state.showRightBar || this.state.fullScreen;\n    const rightBar = (\n      <Grid.Column\n        width={displayRightContent ? 4 : 1}\n        style={{ display: 'flex', flexDirection: 'column' }}\n        className={`${\n          this.state.fullScreen\n            ? 'fullHeightColumnFullscreen'\n            : 'fullHeightColumn'\n        }`}\n      >\n        <Input\n          inverted\n          fluid\n          label={'My name is:'}\n          value={this.state.myName}\n          onChange={this.updateName}\n          style={{ visibility: displayRightContent ? '' : 'hidden' }}\n          icon={\n            <Icon\n              onClick={() => this.updateName(null, { value: generateName() })}\n              name=\"refresh\"\n              inverted\n              circular\n              link\n            />\n          }\n        />\n        {\n          <Menu\n            inverted\n            widths={3}\n            style={{\n              marginTop: '4px',\n              marginBottom: '4px',\n              visibility: displayRightContent ? '' : 'hidden',\n            }}\n          >\n            <Menu.Item\n              name=\"chat\"\n              active={this.state.currentTab === 'chat'}\n              onClick={() => {\n                this.setState({ currentTab: 'chat', unreadCount: 0 });\n              }}\n              as=\"a\"\n            >\n              Chat\n              {this.state.unreadCount > 0 && (\n                <Label circular color=\"red\">\n                  {this.state.unreadCount}\n                </Label>\n              )}\n            </Menu.Item>\n            <Menu.Item\n              name=\"people\"\n              active={this.state.currentTab === 'people'}\n              onClick={() => this.setState({ currentTab: 'people' })}\n              as=\"a\"\n            >\n              People\n              <Label\n                circular\n                color={\n                  getColorForString(\n                    this.state.participants.length.toString()\n                  ) as SemanticCOLORS\n                }\n              >\n                {this.state.participants.length}\n              </Label>\n            </Menu.Item>\n            <Menu.Item\n              name=\"settings\"\n              active={this.state.currentTab === 'settings'}\n              onClick={() => this.setState({ currentTab: 'settings' })}\n              as=\"a\"\n            >\n              {/* <Icon name=\"setting\" /> */}\n              Settings\n            </Menu.Item>\n          </Menu>\n        }\n        <Chat\n          chat={this.state.chat}\n          nameMap={this.state.nameMap}\n          pictureMap={this.state.pictureMap}\n          socket={this.socket}\n          scrollTimestamp={this.state.scrollTimestamp}\n          getMediaDisplayName={this.getMediaDisplayName}\n          hide={this.state.currentTab !== 'chat' || !displayRightContent}\n          isChatDisabled={this.state.isChatDisabled}\n          owner={this.state.owner}\n          user={this.props.user}\n          ref={this.chatRef}\n        />\n        {this.state.state === 'connected' && (\n          <VideoChat\n            socket={this.socket}\n            participants={this.state.participants}\n            nameMap={this.state.nameMap}\n            pictureMap={this.state.pictureMap}\n            tsMap={this.state.tsMap}\n            rosterUpdateTS={this.state.rosterUpdateTS}\n            hide={this.state.currentTab !== 'people' || !displayRightContent}\n            owner={this.state.owner}\n            user={this.props.user}\n          />\n        )}\n        <SettingsTab\n          hide={this.state.currentTab !== 'settings' || !displayRightContent}\n          user={this.props.user}\n          roomLock={this.state.roomLock}\n          setRoomLock={this.setRoomLock}\n          socket={this.socket}\n          isSubscriber={this.props.isSubscriber}\n          roomId={this.state.roomId}\n          isChatDisabled={this.state.isChatDisabled}\n          setIsChatDisabled={this.setIsChatDisabled}\n          owner={this.state.owner}\n          setOwner={this.setOwner}\n          vanity={this.state.vanity}\n          setVanity={this.setVanity}\n          roomLink={this.state.roomLink}\n          password={this.state.password}\n          setPassword={this.setPassword}\n          clearChat={this.clearChat}\n          roomTitle={this.state.roomTitle}\n          setRoomTitle={this.setRoomTitle}\n          roomDescription={this.state.roomDescription}\n          setRoomDescription={this.setRoomDescription}\n          roomTitleColor={this.state.roomTitleColor}\n          setRoomTitleColor={this.setRoomTitleColor}\n          mediaPath={this.state.mediaPath}\n          setMediaPath={this.setMediaPath}\n        />\n      </Grid.Column>\n    );\n    return (\n      <React.Fragment>\n        {!this.state.isAutoPlayable && (\n          <Modal inverted basic open>\n            <div style={{ display: 'flex', justifyContent: 'center' }}>\n              <Button\n                primary\n                size=\"large\"\n                onClick={() => {\n                  this.setState({ isAutoPlayable: true });\n                  this.setMute(false);\n                  this.setVolume(1);\n                }}\n                icon\n                labelPosition=\"left\"\n              >\n                <Icon name=\"volume up\" />\n                Click to unmute\n              </Button>\n            </div>\n          </Modal>\n        )}\n        {this.state.multiStreamSelection && (\n          <MultiStreamModal\n            streams={this.state.multiStreamSelection}\n            setMedia={this.setMedia}\n            resetMultiSelect={this.resetMultiSelect}\n          />\n        )}\n        {this.state.isVBrowserModalOpen && (\n          <VBrowserModal\n            isSubscriber={this.props.isSubscriber}\n            subscribeButton={subscribeButton}\n            closeModal={() => this.setState({ isVBrowserModalOpen: false })}\n            startVBrowser={this.startVBrowser}\n            user={this.props.user}\n            beta={this.props.beta}\n          />\n        )}\n        {this.state.isScreenShareModalOpen && (\n          <ScreenShareModal\n            closeModal={() => this.setState({ isScreenShareModalOpen: false })}\n            startScreenShare={this.setupScreenShare}\n          />\n        )}\n        {this.state.isFileShareModalOpen && (\n          <FileShareModal\n            closeModal={() => this.setState({ isFileShareModalOpen: false })}\n            startFileShare={this.setupFileShare}\n          />\n        )}\n        {this.state.isSubtitleModalOpen && (\n          <SubtitleModal\n            closeModal={() => this.setState({ isSubtitleModalOpen: false })}\n            socket={this.socket}\n            currentSubtitle={this.state.currentSubtitle}\n            src={this.state.currentMedia}\n            haveLock={this.haveLock}\n            getMediaDisplayName={this.getMediaDisplayName}\n            beta={this.props.beta}\n          />\n        )}\n        {this.state.error && <ErrorModal error={this.state.error} />}\n        {this.state.isErrorAuth && (\n          <PasswordModal\n            savedPasswords={this.state.savedPasswords}\n            roomId={this.state.roomId}\n          />\n        )}\n        {this.state.errorMessage && (\n          <Message\n            negative\n            header=\"Error\"\n            content={this.state.errorMessage}\n            style={{\n              position: 'fixed',\n              bottom: '10px',\n              right: '10px',\n              zIndex: 1000,\n            }}\n          ></Message>\n        )}\n        {this.state.successMessage && (\n          <Message\n            positive\n            header=\"Success\"\n            content={this.state.successMessage}\n            style={{\n              position: 'fixed',\n              bottom: '10px',\n              right: '10px',\n              zIndex: 1000,\n            }}\n          ></Message>\n        )}\n        <TopBar\n          user={this.props.user}\n          isCustomer={this.props.isCustomer}\n          isSubscriber={this.props.isSubscriber}\n          roomTitle={this.state.roomTitle}\n          roomDescription={this.state.roomDescription}\n          roomTitleColor={this.state.roomTitleColor}\n        />\n        {\n          <Grid stackable celled=\"internally\">\n            <Grid.Row id=\"theaterContainer\">\n              <Grid.Column\n                width={this.state.showRightBar ? 12 : 15}\n                className={\n                  this.state.fullScreen\n                    ? 'fullHeightColumnFullscreen'\n                    : 'fullHeightColumn'\n                }\n              >\n                <div\n                  style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    height: '100%',\n                  }}\n                >\n                  {!this.state.fullScreen && (\n                    <React.Fragment>\n                      <ComboBox\n                        setMedia={this.setMedia}\n                        playlistAdd={this.playlistAdd}\n                        playlistDelete={this.playlistDelete}\n                        playlistMove={this.playlistMove}\n                        currentMedia={this.state.currentMedia}\n                        getMediaDisplayName={this.getMediaDisplayName}\n                        launchMultiSelect={this.launchMultiSelect}\n                        streamPath={this.props.streamPath}\n                        mediaPath={this.state.mediaPath}\n                        disabled={!this.haveLock()}\n                        playlist={this.state.playlist}\n                      />\n                      <Separator />\n                      <div\n                        className=\"mobileStack\"\n                        style={{ display: 'flex', gap: '4px' }}\n                      >\n                        {this.screenShareStream && (\n                          <Button\n                            fluid\n                            className=\"toolButton\"\n                            icon\n                            labelPosition=\"left\"\n                            color=\"red\"\n                            onClick={this.stopScreenShare}\n                            disabled={sharer?.id !== this.socket?.id}\n                          >\n                            <Icon name=\"cancel\" />\n                            Stop Share\n                          </Button>\n                        )}\n                        {!this.screenShareStream &&\n                          !sharer &&\n                          !this.isVBrowser() && (\n                            <Popup\n                              content={`Share a tab or an application. Make sure to check \"Share audio\" for best results.`}\n                              trigger={\n                                <Button\n                                  fluid\n                                  className=\"toolButton\"\n                                  disabled={!this.haveLock()}\n                                  icon\n                                  labelPosition=\"left\"\n                                  color={'instagram'}\n                                  onClick={() => {\n                                    this.setState({\n                                      isScreenShareModalOpen: true,\n                                    });\n                                  }}\n                                >\n                                  <Icon name={'slideshare'} />\n                                  Screenshare\n                                </Button>\n                              }\n                            />\n                          )}\n                        {!this.screenShareStream &&\n                          !sharer &&\n                          !this.isVBrowser() && (\n                            <Popup\n                              content=\"Launch a shared virtual browser\"\n                              trigger={\n                                <Button\n                                  fluid\n                                  className=\"toolButton\"\n                                  disabled={!this.haveLock()}\n                                  icon\n                                  labelPosition=\"left\"\n                                  color=\"green\"\n                                  onClick={() => {\n                                    this.setState({\n                                      isVBrowserModalOpen: true,\n                                    });\n                                  }}\n                                >\n                                  <Icon name=\"desktop\" />\n                                  VBrowser\n                                </Button>\n                              }\n                            />\n                          )}\n                        {this.isVBrowser() && (\n                          <Popup\n                            content=\"Choose the person controlling the VBrowser\"\n                            trigger={\n                              <Dropdown\n                                icon=\"keyboard\"\n                                labeled\n                                className=\"icon\"\n                                style={{ height: '36px' }}\n                                button\n                                value={this.state.controller}\n                                placeholder=\"No controller\"\n                                clearable\n                                onChange={this.changeController}\n                                selection\n                                disabled={!this.haveLock()}\n                                options={this.state.participants.map((p) => ({\n                                  text: this.state.nameMap[p.id] || p.id,\n                                  value: p.id,\n                                }))}\n                              ></Dropdown>\n                            }\n                          />\n                        )}\n                        {this.isVBrowser() && (\n                          <Dropdown\n                            icon=\"desktop\"\n                            labeled\n                            className=\"icon\"\n                            style={{ height: '36px' }}\n                            button\n                            disabled={!this.haveLock()}\n                            value={this.state.vBrowserResolution}\n                            onChange={(_e, data) =>\n                              this.setState({\n                                vBrowserResolution: data.value as string,\n                              })\n                            }\n                            selection\n                            options={[\n                              {\n                                text: '1080p (Plus only)',\n                                value: '1920x1080@30',\n                                disabled: !this.state.isVBrowserLarge,\n                              },\n                              {\n                                text: '720p',\n                                value: '1280x720@30',\n                              },\n                              {\n                                text: '576p',\n                                value: '1024x576@60',\n                              },\n                              {\n                                text: '486p',\n                                value: '864x486@60',\n                              },\n                              {\n                                text: '360p',\n                                value: '640x360@60',\n                              },\n                            ]}\n                          ></Dropdown>\n                        )}\n                        {this.isVBrowser() && (\n                          <Button\n                            fluid\n                            className=\"toolButton\"\n                            icon\n                            labelPosition=\"left\"\n                            color=\"red\"\n                            disabled={!this.haveLock()}\n                            onClick={this.stopVBrowser}\n                          >\n                            <Icon name=\"cancel\" />\n                            Stop VBrowser\n                          </Button>\n                        )}\n                        {!this.screenShareStream &&\n                          !sharer &&\n                          !this.isVBrowser() && (\n                            <Popup\n                              content=\"Stream your own video file\"\n                              trigger={\n                                <Button\n                                  fluid\n                                  className=\"toolButton\"\n                                  disabled={!this.haveLock()}\n                                  icon\n                                  labelPosition=\"left\"\n                                  onClick={() => {\n                                    this.setState({\n                                      isFileShareModalOpen: true,\n                                    });\n                                  }}\n                                >\n                                  <Icon name=\"file\" />\n                                  File\n                                </Button>\n                              }\n                            />\n                          )}\n                        {false && (\n                          <SearchComponent\n                            setMedia={this.setMedia}\n                            playlistAdd={this.playlistAdd}\n                            type={'youtube'}\n                            streamPath={this.props.streamPath}\n                            disabled={!this.haveLock()}\n                          />\n                        )}\n                        {Boolean(this.props.streamPath) && (\n                          <SearchComponent\n                            setMedia={this.setMedia}\n                            playlistAdd={this.playlistAdd}\n                            type={'stream'}\n                            streamPath={this.props.streamPath}\n                            launchMultiSelect={this.launchMultiSelect}\n                            disabled={!this.haveLock()}\n                          />\n                        )}\n                      </div>\n                      <Separator />\n                    </React.Fragment>\n                  )}\n                  <div style={{ flexGrow: 1 }}>\n                    <div id=\"playerContainer\">\n                      {(this.state.loading ||\n                        !this.state.currentMedia ||\n                        this.state.nonPlayableMedia) && (\n                        <div\n                          id=\"loader\"\n                          className=\"videoContent\"\n                          style={{\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                          }}\n                        >\n                          {this.state.loading && (\n                            <Dimmer active>\n                              <Loader>\n                                {this.isVBrowser()\n                                  ? 'Launching virtual browser. This can take up to a minute.'\n                                  : ''}\n                              </Loader>\n                            </Dimmer>\n                          )}\n                          {!this.state.loading && !this.state.currentMedia && (\n                            <Message\n                              color=\"yellow\"\n                              icon=\"hand point up\"\n                              header=\"You're not watching anything!\"\n                              content=\"Pick something to watch above.\"\n                            />\n                          )}\n                          {!this.state.loading &&\n                            this.state.nonPlayableMedia && (\n                              <Message\n                                color=\"red\"\n                                icon=\"frown\"\n                                header=\"It doesn't look like this is a media file!\"\n                                content=\"Maybe you meant to launch a VBrowser if you're trying to visit a web page?\"\n                              />\n                            )}\n                        </div>\n                      )}\n                      <iframe\n                        style={{\n                          display:\n                            this.isYouTube() && !this.state.loading\n                              ? 'block'\n                              : 'none',\n                        }}\n                        title=\"YouTube\"\n                        id=\"leftYt\"\n                        className=\"videoContent\"\n                        allowFullScreen\n                        frameBorder=\"0\"\n                        allow=\"autoplay\"\n                        src=\"https://www.youtube.com/embed/?enablejsapi=1&controls=0&rel=0\"\n                      />\n                      {this.isVBrowser() &&\n                      this.getVBrowserPass() &&\n                      this.getVBrowserHost() ? (\n                        <VBrowser\n                          username={this.socket.id}\n                          password={this.getVBrowserPass()}\n                          hostname={this.getVBrowserHost()}\n                          controlling={this.state.controller === this.socket.id}\n                          setLoadingFalse={this.setLoadingFalse}\n                          resolution={this.state.vBrowserResolution}\n                          doPlay={this.doPlay}\n                          setResolution={(data: string) =>\n                            this.setState({ vBrowserResolution: data })\n                          }\n                        />\n                      ) : (\n                        <video\n                          style={{\n                            display:\n                              (this.isVideo() && !this.state.loading) ||\n                              this.state.fullScreen\n                                ? 'block'\n                                : 'none',\n                            width: '100%',\n                            maxHeight:\n                              'calc(100vh - 62px - 36px - 36px - 8px - 41px - 16px)',\n                          }}\n                          id=\"leftVideo\"\n                          onEnded={this.onVideoEnded}\n                          playsInline\n                        ></video>\n                      )}\n                    </div>\n                  </div>\n                  {this.state.currentMedia && controls}\n                  {Boolean(this.state.total) && (\n                    <div>\n                      <Progress\n                        size=\"tiny\"\n                        color=\"green\"\n                        inverted\n                        value={this.state.downloaded}\n                        total={this.state.total}\n                        // indicating\n                        label={\n                          Math.min(\n                            (this.state.downloaded / this.state.total) * 100,\n                            100\n                          ).toFixed(2) +\n                          '% - ' +\n                          formatSpeed(this.state.speed) +\n                          ' - ' +\n                          this.state.connections +\n                          ' connections'\n                        }\n                      ></Progress>\n                    </div>\n                  )}\n                </div>\n                <Button\n                  style={{\n                    position: 'absolute',\n                    top: '50%',\n                    right: 'calc(0% - 18px)',\n                    zIndex: 900,\n                  }}\n                  circular\n                  size=\"mini\"\n                  icon={this.state.showRightBar ? 'angle right' : 'angle left'}\n                  onClick={() =>\n                    this.setState({ showRightBar: !this.state.showRightBar })\n                  }\n                />\n              </Grid.Column>\n              {rightBar}\n            </Grid.Row>\n          </Grid>\n        }\n      </React.Fragment>\n    );\n  }\n}\n\nexport const Separator = () => <div style={{ height: '4px', flexShrink: 0 }} />;\n"]},"metadata":{},"sourceType":"module"}